<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор Перепілок</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">

<style>

/* ---------------------- ГЛОБАЛЬНІ СТИЛІ ---------------------- */

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #fafafa;
    color: #222;
}

h2 {
    margin-top: 40px;
    color: #333;
    padding-bottom: 5px;
    border-bottom: 2px solid #ddd;
}

section {
    padding: 20px;
    background: #fff;
    margin: 20px;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
}

input[type="number"], input[type="date"], input[type="text"] {
    width: 110px;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

button {
    cursor: pointer;
    padding: 8px 14px;
    background: #1976d2;
    border: none;
    border-radius: 6px;
    color: #fff;
    margin: 4px 0;
}

button:hover {
    opacity: 0.85;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
    font-size: 15px;
}

th, td {
    border: 1px solid #ddd;
    padding: 7px;
    text-align: left;
}

th {
    background: #f0f0f0;
}

.right { text-align: right; }
.center { text-align: center; }

.hidden { display: none; }

/* ---------------------- БЛОКИ ФУНКЦІЙ ---------------------- */

.block-header {
    background: #1976d2;
    padding: 10px;
    color: #fff;
    border-radius: 6px 6px 0 0;
    font-size: 17px;
    margin-bottom: 0;
}

.section-content {
    padding: 15px;
}

/* ---------------------- ТАБЛИЦІ ---------------------- */

.table-small td input {
    width: 70px;
}

td input.stock,
td input.price {
    width: 80px;
}

.sum { font-weight: bold; }

/* ---------------------- ІКОНКИ ТА КНОПКИ ---------------------- */

.btn-small {
    padding: 4px 7px;
    margin-left: 6px;
    border-radius: 4px;
    font-size: 13px;
}

.btn-red {
    background: #d32f2f !important;
}

.btn-green {
    background: #388e3c !important;
}

/* ---------------------- ЛОГ, ЗАМОВЛЕННЯ ---------------------- */

.log-row:nth-child(even),
.order-row:nth-child(even) {
    background: #f9f9f9;
}

/* ---------------------- ГРАФІКИ ---------------------- */

.chart-container {
    width: 100%;
    height: 300px;
    margin-top: 15px;
}

/* ---------------------- МЕДІА ---------------------- */

@media (max-width: 768px) {

    table {
        font-size: 13px;
    }

    input[type="number"], input[type="date"], input[type="text"] {
        width: 90px;
    }

    button {
        width: 100%;
        margin-top: 6px;
    }
}

</style>

</head>

<body>

<section>
    <div class="block-header">1. Склад універсального комбікорму</div>
    <div class="section-content">

        <label>Бажана кількість, кг:</label>
        <input type="number" id="targetKg" value="25" step="1" onchange="recalcFeed()">

        <button onclick="applyRecipePreset('starter')">Стартер</button>
        <button onclick="applyRecipePreset('grower')">Гроувер</button>
        <button onclick="applyRecipePreset('layer')">Несучки</button>

        <table id="feedTable">
            <thead>
                <tr>
                    <th>Компонент</th>
                    <th class="right">К-сть, кг</th>
                    <th class="right">Ціна за кг</th>
                    <th class="right">Сума</th>
                </tr>
            </thead>
            <tbody id="feedRows">
                <!-- Генерується автоматично через JS -->
            </tbody>
        </table>

        <h3>Разом:</h3>
        <p>Загальна вага: <b id="feedTotalKg">0</b> кг</p>
        <p>Загальна вартість: <b id="feedTotalCost">0</b> грн</p>

    </div>
</section>

<section>
    <div class="block-header">2. Калькулятор яєць</div>
    <div class="section-content">

        <label>Кількість самок:</label>
        <input type="number" id="hens" value="40" onchange="recalcEggs()">

        <label>Середня несучість (%):</label>
        <input type="number" id="eggRate" value="80" onchange="recalcEggs()">

        <label>Ціна за десяток:</label>
        <input type="number" id="eggPrice10" value="50" onchange="recalcEggs()">

        <p>Добова кількість яєць: <b id="eggsPerDay">0</b></p>
        <p>Доход за день: <b id="incomePerDay">0</b> грн</p>

        <p>За 30 днів:</p>
        <p><b id="eggsPerMonth">0</b> яєць — <b id="incomePerMonth">0</b> грн</p>

    </div>
</section>

<section>
    <div class="block-header">3. Запаси компонентів комбікорму</div>
    <div class="section-content">

        <table id="stockTable">
            <thead>
                <tr>
                    <th>Компонент</th>
                    <th class="right">Є на складі, кг</th>
                    <th class="right">Потрібно, кг</th>
                    <th class="right">Докупити, кг</th>
                </tr>
            </thead>
            <tbody id="stockRows">
                <!-- Генерується автоматично через JS -->
            </tbody>
        </table>

    </div>
</section>

<!-- =============================== -->
<!--    4. ЩОДЕННИК ВИТРАТ І ПОДІЙ   -->
<!-- =============================== -->

<section>
    <div class="block-header">4. Щоденник витрат та подій</div>
    <div class="section-content">

        <label>Дата:</label>
        <input type="date" id="logDate">

        <label>Категорія:</label>
        <input type="text" id="logCategory" placeholder="Наприклад: корм, ремонт">

        <label>Сума, грн:</label>
        <input type="number" id="logAmount" step="1">

        <label>Коментар:</label>
        <input type="text" id="logComment" placeholder="Додаткові деталі">

        <button onclick="addLog()">Додати запис</button>

        <table>
            <thead>
                <tr>
                    <th>Дата</th>
                    <th>Категорія</th>
                    <th>Сума</th>
                    <th>Коментар</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="logBody">
                <!-- Автоматично -->
            </tbody>
        </table>

    </div>
</section>


<!-- =============================== -->
<!--           5. ЗАМОВЛЕННЯ         -->
<!-- =============================== -->

<section>
    <div class="block-header">5. Замовлення (активні та виконані)</div>
    <div class="section-content">

        <h3>Додати нове замовлення</h3>

        <label>Клієнт:</label>
        <input type="text" id="ordName">

        <label>Яєць:</label>
        <input type="number" id="ordEggs">

        <label>Лотків:</label>
        <input type="number" id="ordTrays">

        <label>Дата:</label>
        <input type="date" id="ordDate">

        <label>Примітка:</label>
        <input type="text" id="ordNote">

        <button onclick="addOrder()">Додати</button>

        <h3>Активні замовлення</h3>

        <table>
            <thead>
                <tr>
                    <th>Клієнт</th>
                    <th>Яєць</th>
                    <th>Лотків</th>
                    <th>Дата</th>
                    <th>Примітка</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="ordersActive">
                <!-- Генерується через JS -->
            </tbody>
        </table>

        <h3>Виконані замовлення</h3>

        <table>
            <thead>
                <tr>
                    <th>Клієнт</th>
                    <th>Яєць</th>
                    <th>Лотків</th>
                    <th>Дата</th>
                    <th>Примітка</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="ordersDone">
                <!-- Генерується через JS -->
            </tbody>
        </table>

    </div>
</section>


<!-- =============================== -->
<!--            6. ІНКУБАЦІЯ         -->
<!-- =============================== -->

<section>
    <div class="block-header">6. Інкубація</div>
    <div class="section-content">

        <h3>Додати партію</h3>

        <label>Дата закладки:</label>
        <input type="date" id="incDate">

        <label>Кількість яєць:</label>
        <input type="number" id="incEggs">

        <label>Примітка:</label>
        <input type="text" id="incNote">

        <button onclick="addInc()">Додати партію</button>

        <h3>Список інкубацій</h3>

        <table>
            <thead>
                <tr>
                    <th>Партія</th>
                    <th>Дата</th>
                    <th>Яєць</th>
                    <th>Вилуп</th>
                    <th>Примітка</th>
                    <th>День</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="incBody">
                <!-- Генерується через JS -->
            </tbody>
        </table>

    </div>
</section>


<!-- =============================== -->
<!--          7. ГРАФІКИ             -->
<!-- =============================== -->

<section>
    <div class="block-header">7. Графіки продуктивності</div>
    <div class="section-content">

        <div class="chart-container">
            <canvas id="chartEggs"></canvas>
        </div>

        <div class="chart-container">
            <canvas id="chartIncome"></canvas>
        </div>

    </div>
</section>

<!-- =============================== -->
<!--      8. СТАТИСТИКА ПТАШНИКА     -->
<!-- =============================== -->

<section>
    <div class="block-header">8. Показники пташника</div>
    <div class="section-content">

        <label>Кількість самців:</label>
        <input type="number" id="males" value="10" onchange="recalcFlock()">

        <label>Кількість самок:</label>
        <input type="number" id="females" value="40" onchange="recalcFlock()">

        <label>Смертність (за період):</label>
        <input type="number" id="deaths" value="0" onchange="recalcFlock()">

        <label>Середній вік, днів:</label>
        <input type="number" id="avgAge" value="60" onchange="recalcFlock()">

        <p><b>Усього поголів’я: <span id="flockTotal">50</span></b></p>

    </div>
</section>


<!-- =============================== -->
<!--      9. ЗАПАСИ КОМБІКОРМУ       -->
<!-- =============================== -->

<section>
    <div class="block-header">9. Запаси комбікорму</div>
    <div class="section-content">

        <p>Вводь фактичні залишки на складі. Після розрахунку система підкаже, скільки треба докупити.</p>

        <table>
            <thead>
                <tr>
                    <th>Компонент</th>
                    <th class="right">Є на складі</th>
                    <th class="right">Потрібно</th>
                    <th class="right">Докупити</th>
                </tr>
            </thead>
            <tbody id="stockRows">
                <!-- Автоматично через JS -->
            </tbody>
        </table>

    </div>
</section>


<!-- =============================== -->
<!--       10. ФІНАНСОВИЙ ЗВІТ       -->
<!-- =============================== -->

<section>
    <div class="block-header">10. Фінансовий звіт</div>
    <div class="section-content">

        <label>Період від:</label>
        <input type="date" id="repFrom" onchange="recalcReport()">

        <label>до:</label>
        <input type="date" id="repTo" onchange="recalcReport()">

        <h3>Сумарні показники</h3>

        <p>Витрати: <b id="repCosts">0</b> грн</p>
        <p>Доходи: <b id="repIncome">0</b> грн</p>
        <p>Прибуток: <b id="repProfit">0</b> грн</p>

        <h3>Економіка яйця</h3>

        <p>Собівартість яйця: <b id="repCostPerEgg">0</b> грн</p>
        <p>Прибуток з яйця: <b id="repProfitPerEgg">0</b> грн</p>

    </div>
</section>


<!-- =============================== -->
<!--              11. PWA            -->
<!-- =============================== -->

<section>
    <div class="block-header">11. Оффлайн режим (PWA)</div>
    <div class="section-content">

        <p>Додаток підтримує оффлайн режим. Щоб додати на головний екран:</p>

        <ul>
            <li>На Android: кнопка «Додати на головний екран» у браузері.</li>
            <li>На iOS: Поділитися → «Add to Home Screen».</li>
        </ul>

    </div>
</section>


<!-- =============================== -->
<!--      12. GOOGLE DRIVE BACKUP    -->
<!-- =============================== -->

<section>
    <div class="block-header">12. Резервне копіювання Google Drive</div>
    <div class="section-content">

        <button id="btnDriveLogin">Увійти в Google</button>
        <button id="btnBackup" disabled>Створити резервну копію</button>
        <button id="btnRestore" disabled>Відновити дані</button>

        <p id="driveStatus">Статус: оффлайн</p>

    </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<!-- GOOGLE API -->
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>


<script>

// ===============================
//      СПИСКИ КОМПОНЕНТІВ
// ===============================

const feedComponents = [
    {key:'corn', name:'Кукурудза'},
    {key:'wheat', name:'Пшениця'},
    {key:'barley', name:'Ячмінь'},
    {key:'soy', name:'Соєва макуха'},
    {key:'sunflower', name:'Соняшникова макуха'},
    {key:'fishmeal', name:'Рибне борошно'},
    {key:'yeast', name:'Кормові дріжджі'},
    {key:'tcp', name:'Трикальційфосфат'},
    {key:'dolfos', name:'Дольфос D'},
    {key:'salt', name:'Сіль кухонна'}
];


// ===============================
//     ДОПОМОЖНІ ФУНКЦІЇ
// ===============================

function getInt(id) {
    const el = document.getElementById(id);
    return el ? parseInt(el.value) || 0 : 0;
}

function getFloat(id) {
    const el = document.getElementById(id);
    return el ? parseFloat(el.value) || 0 : 0;
}

function saveData(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
}

function loadData(key, fallback = []) {
    try {
        return JSON.parse(localStorage.getItem(key)) || fallback;
    } catch {
        return fallback;
    }
}


// ===============================
//      ГЕНЕРАЦІЯ ТАБЛИЦЬ
// ===============================

function buildFeedTables() {
    const f = document.getElementById("feedRows");
    const s = document.getElementById("stockRows");

    f.innerHTML = "";
    s.innerHTML = "";

    feedComponents.forEach(c => {
        f.innerHTML += `
            <tr data-key="${c.key}">
                <td>${c.name}</td>
                <td class="qty right">0</td>
                <td><input type="number" class="price" step="0.1" data-key="${c.key}" value="0"></td>
                <td class="sum right">0.00</td>
            </tr>
        `;

        s.innerHTML += `
            <tr data-key="${c.key}">
                <td>${c.name}</td>
                <td><input type="number" class="stock right" step="0.1" value="0"></td>
                <td class="need right">0</td>
                <td class="buy right">0</td>
            </tr>
        `;
    });
}


// ===============================
//        РЕЦЕПТИ КОРМУ
// ===============================

const recipePresets = {
    starter: {
        corn: 8, wheat: 4, barley: 3, soy: 5,
        sunflower: 2, fishmeal: 1, yeast: 1,
        tcp: 0.5, dolfos: 0.5, salt: 0.1
    },
    grower: {
        corn: 10, wheat: 4, barley: 3, soy: 4,
        sunflower: 1, fishmeal: 0.5, yeast: 0.5,
        tcp: 0.5, dolfos: 0.3, salt: 0.1
    },
    layer: {
        corn: 12, wheat: 5, barley: 4, soy: 5,
        sunflower: 2, fishmeal: 0.5, yeast: 0.5,
        tcp: 1, dolfos: 0.5, salt: 0.2
    }
};


function applyRecipePreset(name) {
    const preset = recipePresets[name];
    const rows = document.querySelectorAll("#feedRows tr");

    rows.forEach(row => {
        const k = row.dataset.key;
        const qtyCell = row.querySelector(".qty");
        qtyCell.textContent = preset[k] ?? 0;
    });

    recalcFeed();
}


// ===============================
//        РОЗРАХУНОК КОРМУ
// ===============================

function recalcFeed() {
    const target = getFloat("targetKg");
    let totalKg = 0;
    let totalCost = 0;

    document.querySelectorAll("#feedRows tr").forEach(row => {
        const qty = parseFloat(row.querySelector(".qty").textContent) || 0;
        const price = parseFloat(row.querySelector(".price").value) || 0;
        const sum = qty * price;

        row.querySelector(".sum").textContent = sum.toFixed(2);

        totalKg += qty;
        totalCost += sum;
    });

    document.getElementById("feedTotalKg").textContent = totalKg.toFixed(1);
    document.getElementById("feedTotalCost").textContent = totalCost.toFixed(2);

    recalcStockNeed();
}


// ===============================
//    РОЗРАХУНОК ЗАПАСІВ КОРМУ
// ===============================

function recalcStockNeed() {
    const rows = document.querySelectorAll("#feedRows tr");

    rows.forEach(row => {
        const key = row.dataset.key;
        const qty = parseFloat(row.querySelector(".qty").textContent) || 0;

        const stockRow = document.querySelector(`#stockRows tr[data-key="${key}"]`);
        const have = parseFloat(stockRow.querySelector(".stock").value) || 0;

        let need = qty;
        let buy = need - have;
        if (buy < 0) buy = 0;

        stockRow.querySelector(".need").textContent = need.toFixed(1);
        stockRow.querySelector(".buy").textContent = buy.toFixed(1);
    });
}

document.addEventListener("input", e => {
    if (e.target.classList.contains("price")) recalcFeed();
    if (e.target.classList.contains("stock")) recalcStockNeed();
});


// ===============================
//        КАЛЬКУЛЯТОР ЯЄЦЬ
// ===============================

function recalcEggs() {
    const hens = getInt("hens");
    const rate = getInt("eggRate");
    const price10 = getFloat("eggPrice10");

    const eggsPerDay = hens * rate / 100;
    const incomeDay = eggsPerDay / 10 * price10;

    document.getElementById("eggsPerDay").textContent = eggsPerDay.toFixed(1);
    document.getElementById("incomePerDay").textContent = incomeDay.toFixed(2);

    const eggsMonth = eggsPerDay * 30;
    const incomeMonth = incomeDay * 30;

    document.getElementById("eggsPerMonth").textContent = eggsMonth.toFixed(0);
    document.getElementById("incomePerMonth").textContent = incomeMonth.toFixed(2);
}


// ===============================
//           ЛОГ (ЖУРНАЛ)
// ===============================

let logData = loadData("logData");

function addLog() {
    const d = document.getElementById("logDate").value;
    const cat = document.getElementById("logCategory").value;
    const amount = getFloat("logAmount");
    const comment = document.getElementById("logComment").value;

    if (!d || !cat || !amount) return;

    logData.push({ d, cat, amount, comment });
    saveData("logData", logData);
    renderLog();
}

function renderLog() {
    const body = document.getElementById("logBody");
    body.innerHTML = "";

    logData.forEach((x, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${x.d}</td>
            <td>${x.cat}</td>
            <td>${x.amount}</td>
            <td>${x.comment}</td>
            <td><button class="btn-small btn-red" onclick="delLog(${i})">×</button></td>
        `;
        body.appendChild(tr);
    });
}

function delLog(i) {
    logData.splice(i, 1);
    saveData("logData", logData);
    renderLog();
}

/* ===============================
        ЗАМОВЛЕННЯ
=============================== */

let orders = loadData("orders");

function addOrder() {
    const n = document.getElementById("ordName").value;
    const e = getInt("ordEggs");
    const t = getInt("ordTrays");
    const d = document.getElementById("ordDate").value;
    const note = document.getElementById("ordNote").value;

    if (!n || !e || !d) return;

    orders.push({ n, e, t, d, note, done: false });
    saveData("orders", orders);
    renderOrders();
}

function renderOrders() {
    const active = document.getElementById("ordersActive");
    const done = document.getElementById("ordersDone");

    active.innerHTML = "";
    done.innerHTML = "";

    orders.forEach((o, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${o.n}</td>
            <td>${o.e}</td>
            <td>${o.t}</td>
            <td>${o.d}</td>
            <td>${o.note}</td>
            <td>
                ${o.done 
                    ? `<button class="btn-small btn-red" onclick="delOrder(${i})">×</button>`
                    : `
                        <button class="btn-small btn-green" onclick="finishOrder(${i})">✓</button>
                        <button class="btn-small btn-red" onclick="delOrder(${i})">×</button>`
                }
            </td>
        `;

        if (o.done) done.appendChild(row);
        else active.appendChild(row);
    });
}

function finishOrder(i) {
    orders[i].done = true;
    saveData("orders", orders);
    renderOrders();
}

function delOrder(i) {
    orders.splice(i, 1);
    saveData("orders", orders);
    renderOrders();
}


/* ===============================
            ІНКУБАЦІЯ
=============================== */

let inc = loadData("inc");

function addInc() {
    const d = document.getElementById("incDate").value;
    const eggs = getInt("incEggs");
    const note = document.getElementById("incNote").value;

    if (!d || !eggs) return;

    inc.push({ d, eggs, note, hatch: 0 });
    saveData("inc", inc);
    renderInc();
}

function renderInc() {
    const body = document.getElementById("incBody");
    body.innerHTML = "";

    inc.forEach((x, i) => {
        const day = Math.floor((Date.now() - new Date(x.d)) / 86400000);

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${i+1}</td>
            <td>${x.d}</td>
            <td>${x.eggs}</td>
            <td><input type="number" value="${x.hatch}" onchange="setHatch(${i}, this.value)"></td>
            <td>${x.note}</td>
            <td>${day}</td>
            <td><button class="btn-small btn-red" onclick="delInc(${i})">×</button></td>
        `;

        body.appendChild(tr);
    });
}

function setHatch(i, v) {
    inc[i].hatch = parseInt(v) || 0;
    saveData("inc", inc);
}

function delInc(i) {
    inc.splice(i, 1);
    saveData("inc", inc);
    renderInc();
}


/* ===============================
        ФІНАНСОВИЙ ЗВІТ
=============================== */

function recalcReport() {
    const from = new Date(document.getElementById("repFrom").value);
    const to = new Date(document.getElementById("repTo").value);

    let cost = 0;
    let income = 0;

    logData.forEach(x => {
        const d = new Date(x.d);
        if (d >= from && d <= to) cost += x.amount;
    });

    // Доходи: з яйця (за місяць)
    const hens = getInt("hens");
    const rate = getInt("eggRate");
    const p10 = getFloat("eggPrice10");

    const eggPerDay = hens * rate / 100;
    income = eggPerDay / 10 * p10 * 30;

    const profit = income - cost;

    document.getElementById("repCosts").textContent = cost.toFixed(2);
    document.getElementById("repIncome").textContent = income.toFixed(2);
    document.getElementById("repProfit").textContent = profit.toFixed(2);

    const costPerEgg = cost / (eggPerDay * 30);
    const profitPerEgg = income / (eggPerDay * 30) - costPerEgg;

    document.getElementById("repCostPerEgg").textContent = costPerEgg.toFixed(3);
    document.getElementById("repProfitPerEgg").textContent = profitPerEgg.toFixed(3);
}


/* ===============================
             ГРАФІКИ
=============================== */

let chartEggs, chartIncome;

function buildCharts() {
    const ctx1 = document.getElementById("chartEggs");
    const ctx2 = document.getElementById("chartIncome");

    chartEggs = new Chart(ctx1, {
        type: "line",
        data: {
            labels: Array.from({length: 30}, (_, i) => i+1),
            datasets: [{
                label: "Яєць/день",
                data: Array.from({length: 30}, () => getInt("hens") * getInt("eggRate") / 100),
                borderColor: "#1976d2"
            }]
        }
    });

    chartIncome = new Chart(ctx2, {
        type: "line",
        data: {
            labels: Array.from({length: 30}, (_, i) => i+1),
            datasets: [{
                label: "Дохід/день",
                data: Array.from({length: 30}, () => (getInt("hens") * getInt("eggRate") / 100) / 10 * getFloat("eggPrice10")),
                borderColor: "#388e3c"
            }]
        }
    });
}


/* ===============================
      GOOGLE DRIVE BACKUP
=============================== */

let tokenClient;
let gapiInited = false;
let gisInited = false;

function gapiLoaded() {
    gapi.load("client", async () => {
        await gapi.client.init({
            apiKey: "AIzaSyDqLD-DUMMY-KEY-EXAMPLE",
            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
        });
        gapiInited = true;
        updateDriveStatus();
    });
}

function gisLoaded() {
    tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: "764633127034-9t077tdhl7t1bcrsvml5nlil9vitdool.apps.googleusercontent.com",
        scope: "https://www.googleapis.com/auth/drive.file",
        callback: ""
    });
    gisInited = true;
    updateDriveStatus();
}

function updateDriveStatus() {
    const btnLogin = document.getElementById("btnDriveLogin");
    const btnBackup = document.getElementById("btnBackup");
    const btnRestore = document.getElementById("btnRestore");

    if (gapiInited && gisInited) {
        btnBackup.disabled = false;
        btnRestore.disabled = false;
        document.getElementById("driveStatus").textContent = "Статус: готовий";
    }
}

document.getElementById("btnDriveLogin").onclick = () => {
    tokenClient.callback = (res) => {
        document.getElementById("driveStatus").textContent = "Увійшли в Google";
    };
    tokenClient.requestAccessToken();
};

document.getElementById("btnBackup").onclick = async () => {
    const data = {
        logData,
        orders,
        inc
    };

    const file = new Blob([JSON.stringify(data)], {type: "application/json"});

    await gapi.client.drive.files.create({
        resource: { name: "quail_backup.json" },
        media: { mimeType: "application/json", body: file }
    });

    alert("Резервна копія створена!");
};

document.getElementById("btnRestore").onclick = () => {
    alert("Відновлення буде додано пізніше.");
};


/* ===============================
            INIT
=============================== */

function init() {
    buildFeedTables();
    recalcFeed();
    recalcEggs();
    recalcFlock();
    renderLog();
    renderOrders();
    renderInc();
    buildCharts();
}

window.onload = init;

</script>

</body>
</html>