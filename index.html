<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>Quail Farm Tools PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* === –ì–õ–û–ë–ê–õ–¨–ù–Ü –¢–ï–ú–ò === */
:root {
    --bg: #111;
    --text: #fff;
    --card: #1b1b1b;
    --border: #333;
    --accent: #4caf50;
}
.light {
    --bg: #f3f3f3;
    --text: #111;
    --card: #fff;
    --border: #ccc;
    --accent: #2a7cda;
}
body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: Arial, sans-serif;
}
/* === –í–µ—Ä—Ö–Ω—ñ –≤–∫–ª–∞–¥–∫–∏ === */
.topnav {
    display: flex;
    justify-content: space-around;
    background: var(--card);
    border-bottom: 2px solid var(--border);
}
.tab-btn {
    flex: 1;
    text-align: center;
    padding: 12px;
    font-size: 17px;
    cursor: pointer;
    border-bottom: 4px solid transparent;
}
.tab-btn.active {
    border-bottom: 4px solid var(--accent);
    color: var(--accent);
    font-weight: bold;
}
/* === –°—Ç–æ—Ä—ñ–Ω–∫–∏ === */
.page { display: none; padding: 20px; }
.active-page { display: block; }
.container {
    background: var(--card);
    padding: 20px;
    border-radius: 10px;
    border: 1px solid var(--border);
    margin-top: 20px;
}
/* === –ö–Ω–æ–ø–∫–∏ === */
button {
    background: var(--accent);
    color: #fff;
    padding: 10px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
.btn-small {
    padding: 5px 8px;
    font-size: 12px;
}
/* === –¢–∞–±–ª–∏—Ü—ñ === */
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid var(--border); padding: 6px; text-align: center; }
th { background: var(--accent); color: #fff; }
/* === –°—Ç–∞—Ç—É—Å–∏ === */
.status-active { color: #4caf50; font-weight: bold; }
.status-completed { color: #3498db; font-weight: bold; }
.status-cancelled { color: #e74c3c; font-weight: bold; }
.order-item {
    padding: 12px;
    margin-bottom: 10px;
    background: #0004;
    border-radius: 8px;
}
</style>
</head>

<body>

<!-- === –í–∫–ª–∞–¥–∫–∏ === -->
<div class="topnav">
    <div class="tab-btn active" onclick="openTab('calculator', this)">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
    <div class="tab-btn" onclick="openTab('eggs', this)">ü•ö –Ø–π—Ü—è</div>
    <div class="tab-btn" onclick="openTab('orders', this)">üì¶ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</div>
    <div class="tab-btn" onclick="openTab('finance', this)">üí∞ –§—ñ–Ω–∞–Ω—Å–∏</div>
</div>

<!-- === –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† === -->
<div id="page-calculator" class="page active-page">
    <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ä–º—É</h2>
    <div class="container">
        <table id="feedTable"></table>

        <h3>–û–± º—î–º –∫–æ—Ä–º—É (–∫–≥):</h3>
        <input id="feedVolume" type="number" value="25" />

        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
        <div>
            –°—É–º–∞ –≤—Å—å–æ–≥–æ: <b id="feedTotal">0</b> –≥—Ä–Ω<br>
            –¶—ñ–Ω–∞ –∑–∞ 1 –∫–≥: <b id="feedPerKg">0</b> –≥—Ä–Ω<br>
            –°—É–º–∞ –∑–∞ –æ–± º—î–º: <b id="feedVolumeTotal">0</b> –≥—Ä–Ω
        </div>
    </div>
</div>

<!-- === –Ø–ô–¶–Ø === -->
<div id="page-eggs" class="page">
    <h2>ü•ö –û–±–ª—ñ–∫ —è—î—Ü—å (—â–æ–¥–µ–Ω–Ω–∏–π)</h2>

    <div class="container">
        <label>–î–∞—Ç–∞ –∑–∞–ø–∏—Å—É:</label>
        <input type="date" id="eggsDate" />

        <label>–Ø—î—Ü—å –∑–∞ –¥–æ–±—É:</label>
        <input id="eggsGood" type="number" min="0" />

        <label>–ë—Ä–∞–∫–æ–≤–∞–Ω—ñ:</label>
        <input id="eggsBad" type="number" min="0" />

        <label>–î–ª—è –¥–æ–º—É:</label>
        <input id="eggsHome" type="number" min="0" />

        <button onclick="saveEggRecord()">–î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å</button>

        <h3 style="margin-top:25px;">–ó–≤—ñ—Ç –ø–æ –¥–Ω—è—Ö</h3>
        <div id="eggsReport"></div>
    </div>
</div>

<!-- === –ó–ê–ú–û–í–õ–ï–ù–ù–Ø === -->
<div id="page-orders" class="page">
    <h2>üì¶ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>

    <div class="container">
        <label>–î–∞—Ç–∞:</label>
        <input type="date" id="orderDate" />

        <label>–Ü–º'—è:</label>
        <input type="text" id="orderName" />

        <label>–õ–æ—Ç–∫–∏:</label>
        <input type="number" id="orderTrays" min="1" />

        <label>–î–µ—Ç–∞–ª—ñ:</label>
        <textarea id="orderDetails" rows="2"></textarea>

        <button onclick="addOrder()">–î–æ–¥–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>

        <h3>–£—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
        <div id="ordersList"></div>
    </div>
</div>

<!-- === –§–Ü–ù–ê–ù–°–ò === -->
<div id="page-finance" class="page">
    <h2>üí∞ –§—ñ–Ω–∞–Ω—Å–∏</h2>

    <div class="container">
        <label>–¶—ñ–Ω–∞ –∑–∞ 1 –ª–æ—Ç–æ–∫:</label>
        <input id="trayPrice" type="number" min="0" />

        <button onclick="saveFinanceSettings()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>

        <h3>–ó–∞–≥–∞–ª—å–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è</h3>
        <div id="financeSummary"></div>

        <button onclick="exportCSV()">–ï–∫—Å–ø–æ—Ä—Ç CSV</button>
    </div>
</div>

<script>
/* === –í–∫–ª–∞–¥–∫–∏ === */
function openTab(id, btn){
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active-page"));
    document.getElementById("page-"+id).classList.add("active-page");
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}

/* === –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† === */
const feedComponents = [
    ["–ö—É–∫—É—Ä—É–¥–∑–∞", 10], ["–ü—à–µ–Ω–∏—Ü—è", 5], ["–Ø—á–º—ñ–Ω—å", 1.5],
    ["–°–æ—î–≤–∞ –º–∞–∫—É—Ö–∞", 3], ["–°–æ–Ω—è—à–Ω–∏–∫–æ–≤–∞ –º–∞–∫—É—Ö–∞", 2.5], ["–†–∏–±–Ω–µ –±–æ—Ä–æ—à–Ω–æ", 1],
    ["–ö–æ—Ä–º–æ–≤—ñ –¥—Ä—ñ–∂–¥–∂—ñ", 0.7], ["–¢—Ä–∏–∫–∞–ª—å—Ü—ñ–π—Ñ–æ—Å—Ñ–∞—Ç", 0.5],
    ["Dolfos D", 0.7], ["–°—ñ–ª—å", 0.05]
];

function loadFeedTable(){
    let html = `
        <tr><th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th><th>–ö-—Å—Ç—å</th><th>–¶—ñ–Ω–∞</th><th>–°—É–º–∞</th></tr>`;
    feedComponents.forEach((c,i)=>{
        let price = localStorage.getItem("fp"+i) || 0;
        html += `
        <tr>
            <td>${c[0]}</td>
            <td><input id="fq${i}" type="number" value="${c[1]}"></td>
            <td><input id="fp${i}" type="number" value="${price}"></td>
            <td id="fs${i}">0</td>
        </tr>`;
    });
    document.getElementById("feedTable").innerHTML = html;
}
loadFeedTable();

function calcFeed(){
    let total=0, kg=0;
    feedComponents.forEach((c,i)=>{
        let q = Number(document.getElementById("fq"+i).value);
        let p = Number(document.getElementById("fp"+i).value);
        localStorage.setItem("fp"+i,p);
        let sum = q*p;
        document.getElementById("fs"+i).innerHTML = sum.toFixed(2);
        total += sum; kg += q;
    });
    document.getElementById("feedTotal").innerHTML = total.toFixed(2);
    let perkg = kg ? total/kg : 0;
    document.getElementById("feedPerKg").innerHTML = perkg.toFixed(2);
    let vol = Number(document.getElementById("feedVolume").value);
    document.getElementById("feedVolumeTotal").innerHTML = (vol*perkg).toFixed(2);
}
document.addEventListener("input", calcFeed);
calcFeed();

/* === –Ø–ô–¶–Ø (–æ–¥–∏–Ω –∑–∞–ø–∏—Å –Ω–∞ –¥–µ–Ω—å, –≤–∏–±—ñ—Ä –¥–∞—Ç–∏) ===*/
let eggsLog = JSON.parse(localStorage.getItem("eggsLog") || "{}");

function saveEggRecord(){
    let date = document.getElementById("eggsDate").value;
    if(!date){
        let d=new Date();
        date = d.toISOString().slice(0,10);
    }

    eggsLog[date] = {
        good: Number(document.getElementById("eggsGood").value),
        bad: Number(document.getElementById("eggsBad").value),
        home: Number(document.getElementById("eggsHome").value)
    };

    localStorage.setItem("eggsLog", JSON.stringify(eggsLog));
    renderEggs();
}

function renderEggs(){
    let html="";
    let dates = Object.keys(eggsLog).sort().reverse();
    let totalForFinance=0;

    dates.forEach(d=>{
        let e = eggsLog[d];
        let commercial = Math.max(e.good - e.bad - e.home, 0);
        let trays = Math.floor(commercial/20);

        totalForFinance += commercial;

        html+=`
        <div class="order-item">
            <b>${d}</b><br>
            –Ø—î—Ü—å: ${e.good}<br>
            –ë—Ä–∞–∫: ${e.bad}<br>
            –î–ª—è –¥–æ–º—É: ${e.home}<br>
            –ö–æ–º–µ—Ä—Ü—ñ–π–Ω—ñ: ${commercial}<br>
            –õ–æ—Ç–∫—ñ–≤: ${trays}<br>
            <button class="btn-small" onclick="deleteEgg('${d}')">–í–∏–¥–∞–ª–∏—Ç–∏</button>
        </div>`;
    });

    window.totalCommercialEggs = totalForFinance;
    document.getElementById("eggsReport").innerHTML = html;
    renderFinance();
}
function deleteEgg(d){
    delete eggsLog[d];
    localStorage.setItem("eggsLog", JSON.stringify(eggsLog));
    renderEggs();
}
renderEggs();

/* === –ó–ê–ú–û–í–õ–ï–ù–ù–Ø B (–ø–æ –¥–∞—Ç–∞—Ö + –¥–µ—Ç–∞–ª—ñ) === */
let orders = JSON.parse(localStorage.getItem("orders") || "[]");

function addOrder(){
    let d = document.getElementById("orderDate").value;
    if(!d){
        let x=new Date();
        d=x.toISOString().slice(0,10);
    }

    orders.push({
        date: d,
        name: document.getElementById("orderName").value,
        trays: Number(document.getElementById("orderTrays").value),
        details: document.getElementById("orderDetails").value,
        status: "active"
    });

    localStorage.setItem("orders", JSON.stringify(orders));
    renderOrders();
}

function renderOrders(){
    let html="";
    let sorted = [...orders].sort((a,b)=>b.date.localeCompare(a.date));

    sorted.forEach((o,i)=>{
        html += `
        <div class="order-item">
            <b>${o.date}</b><br>
            ${o.name} ‚Äî ${o.trays} –ª–æ—Ç–∫—ñ–≤<br>
            –î–µ—Ç–∞–ª—ñ: ${o.details}<br>
            –°—Ç–∞—Ç—É—Å: <span class="status-${o.status}">${o.status}</span><br>
            <button class="btn-small" onclick="setStatus(${i},'completed')">–í–∏–∫–æ–Ω–∞–Ω–æ</button>
            <button class="btn-small" onclick="setStatus(${i},'cancelled')">–°–∫–∞—Å–æ–≤–∞–Ω–æ</button>
            <button class="btn-small" onclick="deleteOrder(${i})">–í–∏–¥–∞–ª–∏—Ç–∏</button>
        </div>`;
    });

    document.getElementById("ordersList").innerHTML = html;
    renderFinance();
}

function setStatus(i,status){
    orders[i].status=status;
    localStorage.setItem("orders", JSON.stringify(orders));
    renderOrders();
}
function deleteOrder(i){
    orders.splice(i,1);
    localStorage.setItem("orders", JSON.stringify(orders));
    renderOrders();
}
renderOrders();

/* === –§–Ü–ù–ê–ù–°–ò === */
function saveFinanceSettings(){
    localStorage.setItem("trayPrice", document.getElementById("trayPrice").value);
    renderFinance();
}
function renderFinance(){
    let price = Number(localStorage.getItem("trayPrice") || 0);
    document.getElementById("trayPrice").value = price;

    let completed = orders.filter(o=>o.status==="completed");
    let totalTrays = completed.reduce((s,o)=>s+o.trays,0);
    let totalMoney = totalTrays * price;

    let eggIncome = Math.floor((window.totalCommercialEggs||0)/20)*price;

    document.getElementById("financeSummary").innerHTML = `
        <b>–í–∏–∫–æ–Ω–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</b> ${totalTrays} –ª–æ—Ç–∫—ñ–≤ ‚Üí ${totalMoney} –≥—Ä–Ω<br>
        <b>–Ø–π—Ü—è (–∫–æ–º–µ—Ä—Ü—ñ–π–Ω—ñ):</b> ${(window.totalCommercialEggs||0)} —à—Ç ‚Üí ${eggIncome} –≥—Ä–Ω<br>
        <hr>
        <b>–†–∞–∑–æ–º:</b> ${totalMoney + eggIncome} –≥—Ä–Ω
    `;
}
renderFinance();

/* === CSV === */
function exportCSV(){
    let csv="–î–∞—Ç–∞,–ö–ª—ñ—î–Ω—Ç,–õ–æ—Ç–∫–∏,–°—Ç–∞—Ç—É—Å,–î–µ—Ç–∞–ª—ñ\n";
    orders.forEach(o=>{
        csv += `${o.date},${o.name},${o.trays},${o.status},${o.details}\n`;
    });

    let blob=new Blob([csv],{type:"text/csv"});
    let url=URL.createObjectURL(blob);
    let a=document.createElement("a");
    a.href=url;
    a.download="orders.csv";
    a.click();
}
</script>

</body>
</html>