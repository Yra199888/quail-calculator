<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Quail Farm Tools PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ========= –ì–õ–û–ë–ê–õ–¨–ù–Ü –¢–ï–ú–ò ========= */
:root {
    --bg: #111;
    --text: #fff;
    --card: #1b1b1b;
    --border: #333;
    --accent: #4caf50;
}
.light {
    --bg: #f3f3f3;
    --text: #111;
    --card: #fff;
    --border: #ccc;
    --accent: #2a7cda;
}

body {
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0;
    font-family: Arial;
    transition: .3s;
}

/* ========= –í–ï–†–•–ù–Ü –í–ö–õ–ê–î–ö–ò ========= */
.topnav {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: var(--card);
    border-bottom: 2px solid var(--border);
    padding-top: 10px;
}

.tab-btn {
    flex: 1;
    text-align: center;
    padding: 14px 0;
    cursor: pointer;
    font-size: 18px;
    color: var(--text);
    border-bottom: 4px solid transparent;
}

.tab-btn.active {
    font-weight: bold;
    color: var(--accent);
    border-bottom: 4px solid var(--accent);
}

/* ========= –°–¢–û–†–Ü–ù–ö–ò ========= */
.page {
    display: none;
    padding: 20px;
    padding-bottom: 80px;
}
.active-page {
    display: block;
}

.container {
    max-width: 900px;
    margin: auto;
    background: var(--card);
    padding: 20px;
    border-radius: 10px;
    border: 1px solid var(--border);
    margin-top: 20px;
}

/* ========= –°–ü–û–í–Ü–©–ï–ù–ù–Ø ========= */
#saveAlert {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--accent);
    color: #fff;
    padding: 10px 20px;
    border-radius: 6px;
    opacity: 0;
    pointer-events: none;
    transition: 0.4s;
    z-index: 9999;
}
#saveAlert.show {
    opacity: 1;
    transform: translateY(10px);
}

/* ========= –¢–ê–ë–õ–ò–¶–Ü ========= */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}
td, th {
    border: 1px solid var(--border);
    padding: 8px;
    text-align: center;
}
th {
    background: var(--accent);
    color: #fff;
}

input, textarea {
    background: #0003;
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px;
    border-radius: 6px;
    width: 100%;
}

.result {
    font-size: 20px;
    line-height: 1.6;
}

.row-highlight {
    background: #1fae4a !important;
    transition: 0.4s;
}

/* ========= –û–ë–õ–Ü–ö –Ø–Ñ–¶–¨ ========= */
.day-block {
    background: #0005;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
}

/* ========= –ó–ê–ú–û–í–õ–ï–ù–ù–Ø ========= */
.order-block {
    background: #0004;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
    margin-bottom: 12px;
}

.status-active { color: #4caf50; font-weight: bold; }
.status-completed { color: #2196f3; font-weight: bold; }
.status-cancelled { color: #f44336; font-weight: bold; }

.btn-small {
    padding: 5px 10px;
    border-radius: 5px;
    margin-right: 5px;
    cursor: pointer;
    border: none;
    color: #fff;
}
.btn-complete { background: #2196f3; }
.btn-cancel { background: #f44336; }
.btn-delete { background: #555; }

</style>
</head>
<body>

<div id="saveAlert">–ó–±–µ—Ä–µ–∂–µ–Ω–æ ‚úî</div>

<!-- –ó–í–£–ö -->
<audio id="blipSound">
    <source src="data:audio/wav;base64,
    UklGRuQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YcQAAACQkJCQkJCQkJCQ
    kJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJC
    QkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJC" type="audio/wav">
</audio>

<!-- ======== –í–ï–†–•–ù–Ü –í–ö–õ–ê–î–ö–ò ======== -->
<div class="topnav">
    <div class="tab-btn active" onclick="openTab('calculator', this)">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
    <div class="tab-btn" onclick="openTab('eggs', this)">ü•ö –Ø–π—Ü—è</div>
    <div class="tab-btn" onclick="openTab('orders', this)">üì¶ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</div>
</div>

<!-- ========= –í–∫–ª–∞–¥–∫–∞: –û–ë–õ–Ü–ö –Ø–Ñ–¶–¨ ========= -->
<div class="page" id="page-eggs">
    <h2 style="text-align:center;">ü•ö –û–±–ª—ñ–∫ —è—î—Ü—å</h2>

    <div class="container">

        <label>–Ø–π—Ü—è –∑–∞ –¥–æ–±—É:</label><br>
        <input id="eggsGood" type="number" value="0"><br><br>

        <label>–ë—Ä–∞–∫–æ–≤–∞–Ω—ñ:</label><br>
        <input id="eggsBad" type="number" value="0"><br><br>

        <label>–î–ª—è –¥–æ–º—É:</label><br>
        <input id="eggsHome" type="number" value="0"><br><br>

        <button onclick="saveEggs()" style="padding:10px 20px; background:var(--accent); color:#fff; border:none; border-radius:5px;">
            –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å
        </button>

        <hr>
        <h3>–©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç</h3>

        <div id="eggsReport"></div>

    </div>
</div>


<script>
/* ========= –û–ë–õ–Ü–ö –Ø–Ñ–¶–¨ ========= */

function saveEggs() {
    const good = +document.getElementById("eggsGood").value || 0;
    const bad  = +document.getElementById("eggsBad").value || 0;
    const home = +document.getElementById("eggsHome").value || 0;

    const sell = Math.max(good - bad - home, 0);
    const fullTrays = Math.floor(sell / 20);

    const today = new Date().toISOString().split("T")[0];

    let eggsData = JSON.parse(localStorage.getItem("eggsLog")) || {};

    eggsData[today] = {
        good, bad, home,
        sell,
        fullTrays
    };

    localStorage.setItem("eggsLog", JSON.stringify(eggsData));

    playBlip();
    showSaveAlert();
    updateEggsStats();
    renderEggsReport();
}

function updateEggsStats() {
    let eggsData = JSON.parse(localStorage.getItem("eggsLog")) || {};
    const today = new Date().toISOString().split("T")[0];

    let d = eggsData[today] || { sell: 0, fullTrays: 0 };

    // –î–∞–Ω—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤ —ñ–Ω—à–∏—Ö –º—ñ—Å—Ü—è—Ö, –∑–æ–∫—Ä–µ–º–∞ –≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö
}

function renderEggsReport() {
    let eggsData = JSON.parse(localStorage.getItem("eggsLog")) || {};

    let html = "";
    let dates = Object.keys(eggsData).sort().reverse();

    dates.forEach(date => {
        let d = eggsData[date];

        html += `
        <div class="container" style="margin-top:10px;">
            <b>${date}</b><br>
            –í—Å—å–æ–≥–æ: ${d.good}<br>
            –ë—Ä–∞–∫: ${d.bad}<br>
            –î–ª—è –¥–æ–º—É: ${d.home}<br>
            –ö–æ–º–µ—Ä—Ü—ñ–π–Ω—ñ: ${d.sell}<br>
            –ü–æ–≤–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤: ${d.fullTrays}<br><br>

            <button onclick="deleteEggRecord('${date}')" 
                style="padding:5px 10px; background:#c62828; color:#fff; border:none; border-radius:4px;">
                –í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å
            </button>
        </div>
        `;
    });

    document.getElementById("eggsReport").innerHTML = html;
}

function deleteEggRecord(date) {
    let eggsData = JSON.parse(localStorage.getItem("eggsLog")) || {};

    delete eggsData[date];

    localStorage.setItem("eggsLog", JSON.stringify(eggsData));

    playBlip();
    showSaveAlert();
    renderEggsReport();
}

renderEggsReport();
updateEggsStats();
</script>

<script>
/* ===========================
   üåº –°–ü–û–í–Ü–©–ï–ù–ù–Ø + –ó–í–£–ö
=========================== */
function showSaveAlert(message = "–ó–±–µ—Ä–µ–∂–µ–Ω–æ ‚úî") {
    const alert = document.getElementById("saveAlert");
    alert.innerText = message;
    alert.classList.add("show");
    setTimeout(() => alert.classList.remove("show"), 1200);
}

function playBlip() {
    const s = document.getElementById("blipSound");
    s.currentTime = 0;
    s.volume = 0.25;
    s.play();
}

/* ===========================
   üåº –Ø–ô–¶–Ø ‚Äî –õ–û–ì–Ü–ö–ê
=========================== */
// –§–æ—Ä–º–∞—Ç A: 1 –∑–∞–ø–∏—Å –Ω–∞ –¥–µ–Ω—å

function saveEggs() {
    const good = +document.getElementById("eggsGood").value || 0;
    const bad  = +document.getElementById("eggsBad").value || 0;
    const home = +document.getElementById("eggsHome").value || 0;

    const sell = Math.max(good - bad - home, 0);
    const trayCount = Math.floor(sell / 20);

    const today = new Date().toISOString().split("T")[0];

    let eggs = JSON.parse(localStorage.getItem("eggsLog")) || {};
    eggs[today] = { good, bad, home, sell, trays: trayCount };

    localStorage.setItem("eggsLog", JSON.stringify(eggs));

    playBlip();
    showSaveAlert();

    renderEggsReport();
    updateOrderStats();
}

function deleteEggEntry(date) {
    let eggs = JSON.parse(localStorage.getItem("eggsLog")) || {};
    delete eggs[date];
    localStorage.setItem("eggsLog", JSON.stringify(eggs));
    renderEggsReport();
    updateOrderStats();
}

function renderEggsReport() {
    let eggs = JSON.parse(localStorage.getItem("eggsLog")) || {};
    let html = "";

    const dates = Object.keys(eggs).sort((a,b)=> b.localeCompare(a));

    dates.forEach(date => {
        const e = eggs[date];
        html += `
        <div class="egg-day">
            <h3>${date}</h3>
            <p>–í—Å—å–æ–≥–æ: <b>${e.good}</b></p>
            <p>–ë—Ä–∞–∫: <b>${e.bad}</b></p>
            <p>–î–ª—è –¥–æ–º—É: <b>${e.home}</b></p>
            <p>–ö–æ–º–µ—Ä—Ü—ñ–π–Ω—ñ: <b>${e.sell}</b></p>
            <p>–ü–æ–≤–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤: <b>${e.trays}</b></p>
            <button onclick="deleteEggEntry('${date}')" class="small-btn delete">–í–∏–¥–∞–ª–∏—Ç–∏</button>
        </div>`;
    });

    document.getElementById("eggReport").innerHTML = html;
}

/* ===========================
   üì¶ –ó–ê–ú–û–í–õ–ï–ù–ù–Ø ‚Äî –õ–û–ì–Ü–ö–ê
=========================== */

function addOrder() {
    const name = document.getElementById("orderName").value.trim();
    const trays = +document.getElementById("orderTrays").value || 0;
    const details = document.getElementById("orderDetails").value.trim();
    const date = document.getElementById("orderDate").value || 
                 new Date().toISOString().split("T")[0];

    if (!name || trays <= 0) {
        showSaveAlert("–ü–æ–º–∏–ª–∫–∞: –≤–≤–µ–¥—ñ—Ç—å —ñ–º º—è —ñ –ª–æ—Ç–∫–∏");
        return;
    }

    let orders = JSON.parse(localStorage.getItem("orders")) || {};

    if (!orders[date]) orders[date] = [];

    orders[date].push({
        name, trays, details,
        status: "active"
    });

    localStorage.setItem("orders", JSON.stringify(orders));
    playBlip();
    showSaveAlert("–î–æ–¥–∞–Ω–æ ‚úî");

    renderOrders();
    updateOrderStats();
}

// ===== –ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É =====
function setOrderStatus(date, index, status) {
    let orders = JSON.parse(localStorage.getItem("orders")) || {};
    orders[date][index].status = status;
    localStorage.setItem("orders", JSON.stringify(orders));

    // –§—ñ–Ω–∞–Ω—Å–∏: Completed ‚Üí –¥–æ–¥–∞—î–º–æ –≤ —ñ—Å—Ç–æ—Ä—ñ—é –¥–æ—Ö–æ–¥—ñ–≤
    if (status === "completed") {
        let history = JSON.parse(localStorage.getItem("financeHistory")) || [];
        const trays = orders[date][index].trays;
        const price = +(localStorage.getItem("trayPrice") || 0);
        history.push({
            date,
            trays,
            income: trays * price
        });
        localStorage.setItem("financeHistory", JSON.stringify(history));
    }

    renderOrders();
    updateOrderStats();
}

// ===== –í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è =====
function deleteOrder(date, index) {
    let orders = JSON.parse(localStorage.getItem("orders")) || {};
    orders[date].splice(index,1);
    if (orders[date].length === 0) delete orders[date];
    localStorage.setItem("orders", JSON.stringify(orders));

    renderOrders();
    updateOrderStats();
}

// ===== –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HTML =====
function renderOrders() {
    let orders = JSON.parse(localStorage.getItem("orders")) || {};
    let html = "";

    const dates = Object.keys(orders).sort((a,b)=> b.localeCompare(a));

    dates.forEach(date => {
        html += `<h3>${date}</h3>`;

        orders[date].forEach((o, index) => {

            const color = 
                o.status === "active" ? "#4caf50" :
                o.status === "completed" ? "#2196f3" :
                "#f44336";

            html += `
            <div class="order-entry">
                <p><b>${o.name}</b> ‚Äî ${o.trays} –ª–æ—Ç–∫—ñ–≤</p>
                <p style="color:${color};">–°—Ç–∞—Ç—É—Å: ${o.status}</p>
                <p>–î–µ—Ç–∞–ª—ñ: ${o.details || "‚Äî"}</p>

                <button onclick="setOrderStatus('${date}', ${index}, 'completed')" class="small-btn good">–í–∏–∫–æ–Ω–∞–Ω–æ</button>
                <button onclick="setOrderStatus('${date}', ${index}, 'cancelled')" class="small-btn warn">–°–∫–∞—Å–æ–≤–∞–Ω–æ</button>
                <button onclick="deleteOrder('${date}', ${index})" class="small-btn delete">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </div>`;
        });
    });

    document.getElementById("ordersList").innerHTML = html;
}

/* ===========================
   üí∞ –§–Ü–ù–ê–ù–°–û–í–ê –Ü–°–¢–û–†–Ü–Ø
=========================== */
function updateFinanceHistory() {
    let history = JSON.parse(localStorage.getItem("financeHistory")) || [];
    let price = +(localStorage.getItem("trayPrice") || 0);

    let totalIncome = 0;

    let html = "";
    history.forEach(h => {
        totalIncome += h.income;
        html += `
        <div class="fin-entry">
            <b>${h.date}</b> ‚Äî ${h.trays} –ª–æ—Ç–∫—ñ–≤ √ó ${price} –≥—Ä–Ω = <b>${h.income} –≥—Ä–Ω</b>
        </div>`;
    });

    document.getElementById("financeHistory").innerHTML = html;
    document.getElementById("totalIncome").innerText = totalIncome;
}

/* ===========================
   üîÑ –°–¢–ê–¢–ò–°–¢–ò–ö–ê –õ–û–¢–ö–Ü–í
=========================== */
function updateOrderStats() {
    let eggs = JSON.parse(localStorage.getItem("eggsLog")) || {};
    let orders = JSON.parse(localStorage.getItem("orders")) || {};

    // –ü–æ–≤–Ω—ñ –ª–æ—Ç–∫–∏
    let traysTotal = 0;
    Object.values(eggs).forEach(e => traysTotal += e.trays);

    // –ó–∞–±—Ä–æ–Ω—å–æ–≤–∞–Ω–æ (—Ç—ñ–ª—å–∫–∏ active)
    let reserved = 0;
    Object.values(orders).forEach(arr => {
        arr.forEach(o => {
            if (o.status === "active") reserved += o.trays;
        });
    });

    let free = traysTotal - reserved;

    document.getElementById("traysTotal").innerText = traysTotal;
    document.getElementById("reserved").innerText = reserved;
    document.getElementById("freeTrays").innerText = free;
}

// ==========================
// üåº –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
// ==========================

renderEggsReport();
renderOrders();
updateOrderStats();
updateFinanceHistory();

</script>

</body>
</html>