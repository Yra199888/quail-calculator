<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
<!-- PWA manifest -->
<link rel="manifest" href="manifest.webmanifest">

<!-- iPhone fullscreen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="–ü–µ—Ä–µ–ø—ñ–ª–∫–∏">

<!-- Icon for iPhone -->
<link rel="apple-touch-icon" href="icon.PNG">

<!-- Basic PWA theme -->
<meta name="theme-color" content="#ffffff">
  <title>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–æ—Ä–º—É, –æ–±–ª—ñ–∫ —è—î—Ü—å —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å</title>
  <style>
  body {
    font-family: Arial, sans-serif;
    max-width: 960px;
    margin: 0 auto;
    padding: 10px 15px 30px;
    box-sizing: border-box;
  }

  h1, h2, h3 {
    margin-bottom: 6px;
    margin-top: 14px;
  }

  p {
    margin: 4px 0 8px;
  }

  .table-wrapper {
    overflow-x: auto;
    margin-bottom: 16px;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    min-width: 520px;
    margin-bottom: 4px;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 6px 8px;
    text-align: center;
  }

  th {
    background: #f0f0f0;
  }

  input {
    text-align: right;
    padding: 2px 4px;
    box-sizing: border-box;
  }

  input[type="number"] {
    width: 80px;
  }

  input[type="text"] {
    width: 160px;
    text-align: left;
  }

  textarea {
    width: 100%;
    min-height: 50px;
    box-sizing: border-box;
    resize: vertical;
  }

  tfoot td {
    font-weight: bold;
  }

  .right {
    text-align: right;
  }

  .btn {
    display: inline-block;
    padding: 6px 10px;
    margin: 4px 4px 8px 0;
    border: 1px solid #555;
    background: #f5f5f5;
    cursor: pointer;
    border-radius: 4px;
    font-size: 14px;
  }

  .btn:hover {
    background: #e2e2e2;
  }

  .btn-danger {
    border-color: #b00;
    color: #b00;
  }

  .btn-small {
    padding: 2px 6px;
    font-size: 12px;
  }

  .small {
    font-size: 13px;
    color: #555;
  }

  /* ========= –í–ï–†–•–ù–Ø –ü–ê–ù–ï–õ–¨ (–î–∞—à–±–æ—Ä–¥) ========= */

  #topDashboard {
    position: sticky;
    top: 0;
    z-index: 100;
    background: #ffffff;
    padding: 8px 10px 10px;
    margin: -10px -15px 10px; /* —Ç—è–≥–Ω–µ–º–æ —Ñ–æ–Ω –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
    border-bottom: 1px solid #e0e0e0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
  }

  .dash-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 6px;
  }

  .dash-card {
    flex: 1 1 22%;
    min-width: 150px;
    border-radius: 10px;
    padding: 6px 8px;
    background: #f7f9ff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12);
  }

  .dash-label {
    font-size: 12px;
    color: #666;
  }

  .dash-value {
    font-size: 20px;
    font-weight: 600;
    margin-top: 2px;
  }

  /* –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Ä–æ–∑–¥—ñ–ª–∞—Ö (–ö–æ—Ä–º / –Ø–π—Ü—è / ‚Ä¶) */

  .nav-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 4px;
  }

  .nav-btn {
    flex: 1 1 18%;
    text-align: center;
    padding: 6px 4px;
    border-radius: 999px;
    text-decoration: none;
    border: 1px solid #ccc;
    font-size: 13px;
    color: #333;
    background: #f7f7f7;
  }

  .nav-btn:hover {
    background: #e8f0ff;
    border-color: #7ea8ff;
  }

  /* –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –≤–≥–æ—Ä—ñ */

  #topWarnings {
    margin-bottom: 6px;
    font-size: 12px;
  }

  .warn-item {
    padding: 4px 6px;
    border-radius: 6px;
    margin-bottom: 3px;
  }

  .warn-bad {
    background: #ffe5e5;
    color: #800;
  }

  .warn-warn {
    background: #fff5d6;
    color: #885500;
  }

  .warn-ok {
    background: #e7ffe5;
    color: #126612;
  }

  /* ========= –ê–î–ê–ü–¢–ê–¶–Ü–Ø –î–õ–Ø –¢–ï–õ–ï–§–û–ù–£ ========= */

  @media (max-width: 600px) {
    body {
      padding: 6px;
    }

    table {
      font-size: 12px;
      min-width: 480px;
    }

    th, td {
      padding: 4px;
    }

    input[type="number"] {
      width: 70px;
    }

    input[type="text"] {
      width: 120px;
    }

    h1 {
      font-size: 18px;
    }

    h2 {
      font-size: 16px;
    }

    h3 {
      font-size: 15px;
    }

    #topDashboard {
      padding: 6px 6px 8px;
      margin: -6px -6px 8px;
    }

    .dash-card {
      flex: 1 1 48%;
      font-size: 12px;
    }

    .dash-value {
      font-size: 18px;
    }

    .nav-btn {
      flex: 1 1 30%;
      font-size: 12px;
      padding: 5px 2px;
    }
  }
</style>

<script src="https://accounts.google.com/gsi/client" async defer onload="gisLoaded()"></script>
<script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>

</head>
<body>

  <!-- –ì–æ–ª–æ–≤–Ω–∞ –ø–∞–Ω–µ–ª—å —ñ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è -->
  <div id="topDashboard">
    <div class="dash-row">
      <div class="dash-card">
        <div class="dash-label">–Ø—î—Ü—å —Å—å–æ–≥–æ–¥–Ω—ñ</div>
        <div class="dash-value" id="dashEggsToday">0</div>
      </div>
      <div class="dash-card">
        <div class="dash-label">–í—ñ–ª—å–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤</div>
        <div class="dash-value" id="dashFreeTrays">0</div>
      </div>
      <div class="dash-card">
        <div class="dash-label">–ê–∫—Ç–∏–≤–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</div>
        <div class="dash-value" id="dashActiveOrders">0</div>
      </div>
      <div class="dash-card">
        <div class="dash-label">–°–µ—Ä–µ–¥–Ω—è –Ω–µ—Å—É—á—ñ—Å—Ç—å, %</div>
        <div class="dash-value" id="dashProdAvg">0.0</div>
      </div>
    </div>

    <div id="topWarnings"></div>

    <div class="nav-row">
      <a href="#feedSection" class="nav-btn">–ö–æ—Ä–º</a>
      <a href="#eggsSection" class="nav-btn">–Ø–π—Ü—è</a>
      <a href="#ordersSection" class="nav-btn">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
      <a href="#incubationSection" class="nav-btn">–Ü–Ω–∫—É–±–∞—Ü—ñ—è</a>
      <a href="#financeSection" class="nav-btn">–ó–≤—ñ—Ç</a>
    </div>
  </div>

  
  <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ä–º—É, –æ–±–ª—ñ–∫ —è—î—Ü—å —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å (–ø–µ—Ä–µ–ø—ñ–ª–∫–∏)</h1>

  <p class="small">
    ‚úî –ú—ñ–Ω—è—î—à —Ç—ñ–ª—å–∫–∏ <b>—Ü—ñ–Ω–∏ –∑–∞ 1 –∫–≥</b>, –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ç–∞—Ö—ñ–≤, –Ω–æ—Ä–º—É, —è–π—Ü—è, —Ü—ñ–Ω—É –ª–æ—Ç–∫–∞ —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.<br>
    ‚úî –í—Å–µ —ñ–Ω—à–µ —Ä–∞—Ö—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ (–æ–∫—Ä–µ–º–æ –Ω–∞ –∫–æ–∂–Ω–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó).
  </p>

  <!-- 1. –°–∫–ª–∞–¥ –∫–æ—Ä–º—É -->
  <h2 id="feedSection">1. –°–∫–ª–∞–¥ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–º—É (25 –∫–≥)</h2>
   <p>
    –†–µ—Ü–µ–ø—Ç:
    <select id="recipePreset">
      <option value="universal" selected>–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π (25 –∫–≥)</option>
      <option value="high_protein">–î–ª—è –Ω–µ—Å—É—á–æ–∫ (–±—ñ–ª—å—à –±—ñ–ª–∫–æ–≤–∏–π)</option>
      <option value="economy">–ï–∫–æ–Ω–æ–º–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç</option>
    </select>
    <button class="btn btn-small" id="applyPreset">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
  </p>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
          <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å, –∫–≥</th>
          <th>–¶—ñ–Ω–∞, –≥—Ä–Ω/–∫–≥</th>
          <th>–°—É–º–∞, –≥—Ä–Ω</th>
        </tr>
      </thead>
      <tbody id="rows">
        <tr>
          <td>–ö—É–∫—É—Ä—É–¥–∑–∞</td>
          <td class="qty right">10.0</td>
          <td><input type="number" step="0.01" class="price" data-key="corn" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–ü—à–µ–Ω–∏—Ü—è</td>
          <td class="qty right">5.0</td>
          <td><input type="number" step="0.01" class="price" data-key="wheat" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–Ø—á–º—ñ–Ω—å</td>
          <td class="qty right">1.5</td>
          <td><input type="number" step="0.01" class="price" data-key="barley" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–°–æ—î–≤–∞ –º–∞–∫—É—Ö–∞</td>
          <td class="qty right">3.0</td>
          <td><input type="number" step="0.01" class="price" data-key="soy" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–°–æ–Ω—è—à–Ω–∏–∫–æ–≤–∞ –º–∞–∫—É—Ö–∞</td>
          <td class="qty right">2.5</td>
          <td><input type="number" step="0.01" class="price" data-key="sunflower" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–†–∏–±–Ω–µ –±–æ—Ä–æ—à–Ω–æ</td>
          <td class="qty right">1.0</td>
          <td><input type="number" step="0.01" class="price" data-key="fishmeal" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–ö–æ—Ä–º–æ–≤—ñ –¥—Ä—ñ–∂–¥–∂—ñ</td>
          <td class="qty right">0.7</td>
          <td><input type="number" step="0.01" class="price" data-key="yeast" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–¢—Ä–∏–∫–∞–ª—å—Ü—ñ–π—Ñ–æ—Å—Ñ–∞—Ç</td>
          <td class="qty right">0.5</td>
          <td><input type="number" step="0.01" class="price" data-key="tcp" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>Dolfos D</td>
          <td class="qty right">0.7</td>
          <td><input type="number" step="0.01" class="price" data-key="dolfos" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
        <tr>
          <td>–°—ñ–ª—å –∫—É—Ö–æ–Ω–Ω–∞</td>
          <td class="qty right">0.05</td>
          <td><input type="number" step="0.01" class="price" data-key="salt" value="0"></td>
          <td class="sum right">0.00</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td class="right">–†–∞–∑–æ–º:</td>
          <td id="totalQty" class="right">25.0</td>
          <td></td>
          <td id="totalCost" class="right">0.00</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- 2. –¶—ñ–Ω–∞ –∑–∞ 1 –∫–≥ -->
  <h2>2. –¶—ñ–Ω–∞ –∑–∞ 1 –∫–≥</h2>
  <p>–í–∞—Ä—Ç—ñ—Å—Ç—å 1 –∫–≥ –∫–æ—Ä–º—É: <b><span id="pricePerKg">0.00</span> –≥—Ä–Ω/–∫–≥</b></p>

  <!-- 3. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ —Å—Ç–∞–¥—É -->
  <h2>3. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ —Å—Ç–∞–¥—É</h2>
  <p>
    –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–ø—ñ–ª–æ–∫:
    <input type="number" id="birds" value="190" step="1" style="width:80px;">
  </p>
  <p>
    –î–æ–±–æ–≤–∞ –Ω–æ—Ä–º–∞ –Ω–∞ 1 –≥–æ–ª–æ–≤—É (–∫–≥, –Ω–∞–ø—Ä. 0.025 = 25 –≥):
    <input type="number" id="dailyNorm" value="0.025" step="0.001" style="width:80px;">
  </p>

  <div class="table-wrapper">
    <table>
      <tr>
        <td>–î–æ–±–æ–≤–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –∫–æ—Ä–º—É –≤—Å—ñ–º —Å—Ç–∞–¥–æ–º, –∫–≥</td>
        <td class="right"><span id="dailyFeedKg">0.000</span></td>
      </tr>
      <tr>
        <td>–í–∞—Ä—Ç—ñ—Å—Ç—å –≥–æ–¥—É–≤–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ —Å—Ç–∞–¥–∞ –Ω–∞ –¥–µ–Ω—å, –≥—Ä–Ω</td>
        <td class="right"><span id="dailyCost">0.00</span></td>
      </tr>
      <tr>
        <td>–í–∞—Ä—Ç—ñ—Å—Ç—å –≥–æ–¥—É–≤–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ —Å—Ç–∞–¥–∞ –Ω–∞ 30 –¥–Ω—ñ–≤, –≥—Ä–Ω</td>
        <td class="right"><span id="monthlyCost">0.00</span></td>
      </tr>
      <tr>
        <td>–ù–∞ —Å–∫—ñ–ª—å–∫–∏ –¥–Ω—ñ–≤ –≤–∏—Å—Ç–∞—á–∏—Ç—å 25 –∫–≥ –ø—Ä–∏ —Ü—ñ–π –Ω–æ—Ä–º—ñ</td>
        <td class="right"><span id="daysFromBag">0.0</span></td>
      </tr>
    </table>
  </div>

    <!-- 4. –û–±–ª—ñ–∫ —è—î—Ü—å -->
  <h2 id="eggsSection">4. –û–±–ª—ñ–∫ —è—î—Ü—å</h2>

  <p>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑—ñ–±—Ä–∞–Ω–∏—Ö —è—î—Ü—å –∑–∞ –¥–æ–±—É:
    <input type="number" id="eggsTotal" value="0" step="1" style="width:80px;">
  </p>

  <p>–ë—Ä–∞–∫–æ–≤–∞–Ω—ñ —è–π—Ü—è:
    <input type="number" id="eggsBad" value="0" step="1" style="width:80px;">
  </p>

  <p>–î–ª—è –≤–ª–∞—Å–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
    <input type="number" id="eggsOwn" value="0" step="1" style="width:80px;">
  </p>

  <p>–Ø–π—Ü—è, —â–æ –∑–∞–ª–∏—à–∏–ª–∏—Å—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –¥–Ω—ñ–≤ (—Å–∫–ª–∞–¥—Å—å–∫–∏–π –∑–∞–ª–∏—à–æ–∫):
    <input type="number" id="eggsCarry" value="0" step="1" style="width:80px;">
    <span class="small">–Ø–∫—â–æ —â–æ—Å—å –∑–±–∏–ª–æ—Å—è ‚Äì –º–æ–∂–µ—à –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –≤—Ä—É—á–Ω—É.</span>
  </p>

  <div class="table-wrapper">
    <table>
      <tr>
        <td>–Ø—î—Ü—å –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É –°–¨–û–ì–û–î–ù–Ü</td>
        <td class="right"><span id="eggsForSale">0</span></td>
      </tr>
      <tr>
        <td>–í—Å—å–æ–≥–æ —è—î—Ü—å –¥–ª—è –ø—Ä–æ–¥–∞–∂—É (—Ä–∞–∑–æ–º —ñ–∑ –∑–∞–ª–∏—à–∫–æ–º)</td>
        <td class="right"><span id="eggsForSaleTotal">0</span></td>
      </tr>
      <tr>
        <td>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤ (–ø–æ 20 —à—Ç)</td>
        <td class="right"><span id="traysCount">0</span></td>
      </tr>
      <tr>
        <td>–ó–∞–ª–∏—à–æ–∫ —è—î—Ü—å –ø—ñ—Å–ª—è –ø–æ–≤–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤</td>
        <td class="right"><span id="eggsRemainder">0</span></td>
      </tr>
      <tr>
        <td>–¶—ñ–Ω–∞ –∑–∞ 1 –ª–æ—Ç–æ–∫, –≥—Ä–Ω</td>
        <td><input type="number" id="trayPrice" value="0" step="1" style="width:80px;"></td>
      </tr>
      <tr>
        <td>–°—É–º–∞ –≤–∏—Ä—É—á–∫–∏, –≥—Ä–Ω</td>
        <td class="right"><span id="income">0.00</span></td>
      </tr>
    </table>
  </div>

  <h3>4.1. –°–∞–º–∫–∏ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</h3>
  <p>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–∞–º–æ–∫ —É 1-–π –ø–∞—Ä—Ç—ñ—ó (7 —Å–µ—Ä–ø–Ω—è):
    <input type="number" id="hens1" value="0" step="1" style="width:80px;">
  </p>
  <p>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–∞–º–æ–∫ —É 2-–π –ø–∞—Ä—Ç—ñ—ó (19 –∂–æ–≤—Ç–Ω—è):
    <input type="number" id="hens2" value="0" step="1" style="width:80px;">
  </p>
  <div class="table-wrapper">
    <table>
      <tr>
        <td>–°–∞–º–æ–∫ –≤—Å—å–æ–≥–æ</td>
        <td class="right"><span id="hensTotal">0</span></td>
      </tr>
      <tr>
        <td>–§–∞–∫—Ç–∏—á–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å—å–æ–≥–æ–¥–Ω—ñ, %</td>
        <td class="right"><span id="productivityToday">0.0</span></td>
      </tr>
    </table>
  </div>
  
    <h3>4.2. –ü–∞—Å–ø–æ—Ä—Ç –ø–∞—Ä—Ç—ñ–π</h3>
  <p class="small">
    –í–∫–∞–∂–∏ –ø—Ä–∏–±–ª–∏–∑–Ω—É –¥–∞—Ç—É –≤–∏–ª—É–ø—É –¥–ª—è –∫–æ–∂–Ω–æ—ó –ø–∞—Ä—Ç—ñ—ó ‚Äì —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Ä–∞—Ö—É—î –≤—ñ–∫ —Ç–∞ –¥–∞—Å—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä.
  </p>

  <p>
    –î–∞—Ç–∞ –≤–∏–ª—É–ø—É 1-—ó –ø–∞—Ä—Ç—ñ—ó:
    <input type="date" id="hens1Date" style="width:150px;">
  </p>
  <p>
    –î–∞—Ç–∞ –≤–∏–ª—É–ø—É 2-—ó –ø–∞—Ä—Ç—ñ—ó:
    <input type="date" id="hens2Date" style="width:150px;">
  </p>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ü–∞—Ä—Ç—ñ—è</th>
          <th>–î–∞—Ç–∞ –≤–∏–ª—É–ø—É</th>
          <th>–í—ñ–∫, –¥–Ω—ñ–≤</th>
          <th>–°–∞–º–æ–∫</th>
          <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1-—à–∞ –ø–∞—Ä—Ç—ñ—è</td>
          <td class="right"><span id="hens1DateLabel">-</span></td>
          <td class="right"><span id="hens1Age">-</span></td>
          <td class="right"><span id="hens1CountLabel">0</span></td>
          <td><span id="hens1Comment">‚Äî</span></td>
        </tr>
        <tr>
          <td>2-–≥–∞ –ø–∞—Ä—Ç—ñ—è</td>
          <td class="right"><span id="hens2DateLabel">-</span></td>
          <td class="right"><span id="hens2Age">-</span></td>
          <td class="right"><span id="hens2CountLabel">0</span></td>
          <td><span id="hens2Comment">‚Äî</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 5. –ü—ñ–¥—Å—É–º–æ–∫ –¥–Ω—è -->
  <h2>5. –ü—ñ–¥—Å—É–º–æ–∫ –¥–Ω—è (–∫–æ—Ä–º + —è–π—Ü—è)</h2>
  <div class="table-wrapper">
    <table>
      <tr>
        <td>–î–æ–±–æ–≤–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –∫–æ—Ä–º—É (–≤—Å–µ —Å—Ç–∞–¥–æ), –≥—Ä–Ω</td>
        <td class="right"><span id="summaryFeedCost">0.00</span></td>
      </tr>
      <tr>
        <td>–î–æ–±–æ–≤–∞ –≤–∏—Ä—É—á–∫–∞ –≤—ñ–¥ —è—î—Ü—å, –≥—Ä–Ω</td>
        <td class="right"><span id="summaryEggIncome">0.00</span></td>
      </tr>
      <tr>
        <td>–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ –¥–µ–Ω—å (–ø—Ä–∏–±—É—Ç–æ–∫/–∑–±–∏—Ç–æ–∫), –≥—Ä–Ω</td>
        <td class="right"><span id="summaryProfit">0.00</span></td>
      </tr>
    </table>
  </div>

    <!-- 5.1. –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∑–≤—ñ—Ç –∑–∞ –ø–µ—Ä—ñ–æ–¥ -->
  <h2 id="financeSection">5.1. –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∑–≤—ñ—Ç –∑–∞ –ø–µ—Ä—ñ–æ–¥</h2>
  <p>
    –ü–µ—Ä—ñ–æ–¥:
    <select id="reportPeriod">
      <option value="7">–û—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤</option>
      <option value="30" selected>–û—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤</option>
      <option value="all">–ó–∞ –≤–µ—Å—å —á–∞—Å</option>
    </select>
  </p>

  <p>
    –Ü–Ω—à—ñ –ø–æ—Å—Ç—ñ–π–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ (–Ω–∞ –º—ñ—Å—è—Ü—å), –≥—Ä–Ω:
    <input type="number" id="otherCostsMonthly" value="0" step="1" style="width:100px;">
    <span class="small">–ï–ª–µ–∫—Ç—Ä–∏–∫–∞, –ø—ñ–¥—Å—Ç–∏–ª–∫–∞, –∞–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—è —Ç–æ—â–æ</span>
  </p>
  
  <div class="table-wrapper">
    <table>
      <tr>
        <td>–î–Ω—ñ–≤ —É –∑–≤—ñ—Ç—ñ</td>
        <td class="right"><span id="repDays">0</span></td>
      </tr>
      <tr>
        <td>–ó—ñ–±—Ä–∞–Ω–æ —è—î—Ü—å, —à—Ç</td>
        <td class="right"><span id="repEggs">0</span></td>
      </tr>
      <tr>
        <td>–ü—Ä–æ–¥–∞–Ω–æ –ª–æ—Ç–∫—ñ–≤ (–ø–æ 20 —à—Ç)</td>
        <td class="right"><span id="repTrays">0</span></td>
      </tr>
      <tr>
        <td>–í–∏—Ä—É—á–∫–∞, –≥—Ä–Ω</td>
        <td class="right"><span id="repIncome">0.00</span></td>
      </tr>
      <tr>
        <td>–í–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –∫–æ—Ä–º, –≥—Ä–Ω</td>
        <td class="right"><span id="repFeedCost">0.00</span></td>
      </tr>
      <tr>
        <td>–ß–∏—Å—Ç–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø—Ä–∏–±—É—Ç–æ–∫), –≥—Ä–Ω</td>
        <td class="right"><span id="repProfit">0.00</span></td>
      </tr>
      <tr>
        <td>–°–µ—Ä–µ–¥–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, %</td>
        <td class="right"><span id="repProdAvg">0.0</span></td>
      </tr>
      <tr>
        <td>–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å 1 —è–π—Ü—è (–∫–æ—Ä–º), –≥—Ä–Ω</td>
        <td class="right"><span id="repCostPerEgg">0.000</span></td>
      </tr>
      <tr>
        <td>–ü—Ä–∏–±—É—Ç–æ–∫ –∑ 1 —è–π—Ü—è, –≥—Ä–Ω</td>
        <td class="right"><span id="repProfitPerEgg">0.000</span></td>
      </tr>
      <tr>
        <td>–ü—Ä–∏–±—É—Ç–æ–∫ –∑ 1 —Å–∞–º–∫–∏ –∑–∞ –ø–µ—Ä—ñ–æ–¥, –≥—Ä–Ω</td>
        <td class="right"><span id="repProfitPerHen">0.00</span></td>
      </tr>
      <tr>
        <td>–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –∑–∞ –ø–µ—Ä—ñ–æ–¥, –≥—Ä–Ω</td>
        <td class="right"><span id="repOtherCost">0.00</span></td>
      </tr>
      <tr>
        <td>–ü–æ–≤–Ω–∞ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å 1 —è–π—Ü—è (–∫–æ—Ä–º + —ñ–Ω—à—ñ), –≥—Ä–Ω</td>
        <td class="right"><span id="repFullCostPerEgg">0.000</span></td>
      </tr>
      <tr>
        <td>–ü—Ä–∏–±—É—Ç–æ–∫ –∑ 1 —è–π—Ü—è –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –≤—Å—ñ—Ö –≤–∏—Ç—Ä–∞—Ç, –≥—Ä–Ω</td>
        <td class="right"><span id="repProfitPerEggFull">0.000</span></td>
      </tr>
    </table>
  </div>
  
    <h2>5.2. –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 30 –¥–Ω—ñ–≤</h2>
  <p class="small">
    –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ—Ç–æ—á–Ω–æ—ó —Å–µ—Ä–µ–¥–Ω—å–æ—ó –Ω–µ—Å—É—á–æ—Å—Ç—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–∞–º–æ–∫, —Ü—ñ–Ω–∏ –ª–æ—Ç–∫–∞ —Ç–∞ –¥–æ–±–æ–≤–æ—ó –≤–∞—Ä—Ç–æ—Å—Ç—ñ –∫–æ—Ä–º—É.
  </p>

  <div class="table-wrapper">
    <table>
      <tr>
        <td>–û—á—ñ–∫—É–≤–∞–Ω–∏—Ö —è—î—Ü—å –∑–∞ 30 –¥–Ω—ñ–≤</td>
        <td class="right"><span id="fcastEggs">0</span></td>
      </tr>
      <tr>
        <td>–û—á—ñ–∫—É–≤–∞–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤ (–ø–æ 20 —à—Ç)</td>
        <td class="right"><span id="fcastTrays">0</span></td>
      </tr>
      <tr>
        <td>–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤–∏—Ä—É—á–∫–∞, –≥—Ä–Ω</td>
        <td class="right"><span id="fcastIncome">0.00</span></td>
      </tr>
      <tr>
        <td>–û—á—ñ–∫—É–≤–∞–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –∫–æ—Ä–º, –≥—Ä–Ω</td>
        <td class="right"><span id="fcastFeedCost">0.00</span></td>
      </tr>
      <tr>
        <td>–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π –ø—Ä–∏–±—É—Ç–æ–∫ –∑–∞ 30 –¥–Ω—ñ–≤, –≥—Ä–Ω</td>
        <td class="right"><span id="fcastProfit">0.00</span></td>
      </tr>
    </table>
  </div>


  <!-- 6. –©–æ–¥–µ–Ω–Ω–∏–∫ -->
  <h2>6. –©–æ–¥–µ–Ω–Ω–∏–∫ (—ñ—Å—Ç–æ—Ä—ñ—è)</h2>
  <p class="small">
    –¢—É—Ç –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —â–æ–¥–µ–Ω–Ω—ñ –ø—ñ–¥—Å—É–º–∫–∏ (–∫–æ—Ä–º + —è–π—Ü—è). –í—Å–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ.
  </p>

  <p>
    –î–∞—Ç–∞:
    <input type="date" id="logDate" style="width:150px;">
  </p>
  <p>
    –ù–æ—Ç–∞—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: "–¥—Ä—É–≥–∞ –ø–∞—Ä—Ç—ñ—è –¥–∞–ª–∞ –ø–µ—Ä—à–µ —è–π—Ü–µ"):
    <br>
    <textarea id="logNote"></textarea>
  </p>

  <button class="btn" id="addToLog">–î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å —É —â–æ–¥–µ–Ω–Ω–∏–∫</button>
  <button class="btn btn-danger" id="clearLog">–û—á–∏—Å—Ç–∏—Ç–∏ —â–æ–¥–µ–Ω–Ω–∏–∫</button>

  <div class="table-wrapper">
    <table>
       <thead>
        <tr>
          <th>–î–∞—Ç–∞</th>
          <th>–Ø—î—Ü—å –≤—Å—å–æ–≥–æ</th>
          <th>–°–∞–º–æ–∫ –≤—Å—å–æ–≥–æ</th>
          <th>–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, %</th>
          <th>–ù–∞ –ø—Ä–æ–¥–∞–∂ —Å—å–æ–≥–æ–¥–Ω—ñ</th>
          <th>–ù–∞ –ø—Ä–æ–¥–∞–∂ —Ä–∞–∑–æ–º —ñ–∑ –∑–∞–ª–∏—à–∫–æ–º</th>
          <th>–õ–æ—Ç–∫—ñ–≤</th>
          <th>–í–∏—Ä—É—á–∫–∞, –≥—Ä–Ω</th>
          <th>–ö–æ—Ä–º/–¥–µ–Ω—å, –≥—Ä–Ω</th>
          <th>–†–µ–∑—É–ª—å—Ç–∞—Ç, –≥—Ä–Ω</th>
          <th>–ù–æ—Ç–∞—Ç–∫–∞</th>
          <th>√ó</th>
        </tr>
      </thead>
      <tbody id="logTableBody">
      </tbody>
    </table>
  </div>
  
  <h2>6.1. –ì—Ä–∞—Ñ—ñ–∫–∏ –Ω–µ—Å—É—á–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤</h2>
  <p class="small">
    –î–ª—è –Ω–∞–æ—á–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –æ—Å—Ç–∞–Ω–Ω—ñ 14 –∑–∞–ø–∏—Å—ñ–≤ –∑—ñ —â–æ–¥–µ–Ω–Ω–∏–∫–∞.
  </p>

  <div class="table-wrapper">
    <h3>–ù–µ—Å—É—á—ñ—Å—Ç—å</h3>
    <canvas id="chartProductivity" height="200" style="width:100%; max-width:900px; border:1px solid #eee;"></canvas>
  </div>

  <div class="table-wrapper">
    <h3>–ü—Ä–æ–¥–∞–∂—ñ (–ª–æ—Ç–∫–∏ —Ç–∞ –≤–∏—Ä—É—á–∫–∞)</h3>
    <canvas id="chartSales" height="200" style="width:100%; max-width:900px; border:1px solid #eee;"></canvas>
  </div>

  <!-- 7. –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —è—î—Ü—å -->
  <h2 id="ordersSection">7. –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —è—î—Ü—å</h2>
  <p class="small">
    –¢—É—Ç —Ç–∏ –∑–∞–ø–∏—Å—É—î—à, <b>—Ö—Ç–æ –∑–∞–º–æ–≤–∏–≤</b> —ñ <b>—Å–∫—ñ–ª—å–∫–∏ –ª–æ—Ç–∫—ñ–≤</b>. –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫—É, –¥–æ–∫–∏ —Ç–∏ –Ω–µ –Ω–∞—Ç–∏—Å–Ω–µ—à "–í–∏–∫–æ–Ω–∞–Ω–æ".
  </p>

  <p>
    –ö–ª—ñ—î–Ω—Ç / —Ö—Ç–æ –∑–∞–º–æ–≤–∏–≤:
    <input type="text" id="orderCustomer" placeholder="–Ü–º'—è / –º–∞–≥–∞–∑–∏–Ω / —Å—É—Å—ñ–¥">
  </p>
  <p>
    <b>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ª–æ—Ç–∫—ñ–≤ —É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ (–ø–æ 20 —è—î—Ü—å):</b>
    <input type="number" id="orderTrays" value="0" step="1" style="width:80px;">
  </p>
  <p>
    –ü—Ä–∏–º—ñ—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: "–∑–∞–±—Ä–∞—Ç–∏ –≤–≤–µ—á–µ—Ä—ñ", "–æ–ø–ª–∞—Ç–∞ –≥–æ—Ç—ñ–≤–∫–æ—é"):
    <br>
    <textarea id="orderNote"></textarea>
  </p>

  <button class="btn" id="addOrder">–î–æ–¥–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
  <button class="btn btn-danger" id="clearOrders">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>

  <h3>–ê–∫—Ç–∏–≤–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ö–ª—ñ—î–Ω—Ç</th>
          <th>–Ø—î—Ü—å</th>
          <th>–õ–æ—Ç–∫—ñ–≤ (20 —à—Ç)</th>
          <th>–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</th>
          <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody id="ordersActiveBody">
      </tbody>
    </table>
  </div>

  <h3>–í–∏–∫–æ–Ω–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ö–ª—ñ—î–Ω—Ç</th>
          <th>–Ø—î—Ü—å</th>
          <th>–õ–æ—Ç–∫—ñ–≤</th>
          <th>–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</th>
          <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>√ó</th>
        </tr>
      </thead>
      <tbody id="ordersDoneBody">
      </tbody>
    </table>
  </div>

    <h4>–ü—ñ–¥—Å—É–º–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å</h4>
  <div class="table-wrapper">
    <table>
      <tr>
        <td>–ê–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å</td>
        <td class="right"><span id="ordersActiveCount">0</span></td>
      </tr>
      <tr>
        <td>–í–∏–∫–æ–Ω–∞–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å</td>
        <td class="right"><span id="ordersDoneCount">0</span></td>
      </tr>
      <tr>
        <td>–í—Å—å–æ–≥–æ –ª–æ—Ç–∫—ñ–≤ (–∞–∫—Ç–∏–≤–Ω—ñ)</td>
        <td class="right"><span id="ordersActiveTrays">0</span></td>
      </tr>
      <tr>
        <td>–í—Å—å–æ–≥–æ –ª–æ—Ç–∫—ñ–≤ (–≤–∏–∫–æ–Ω–∞–Ω—ñ)</td>
        <td class="right"><span id="ordersDoneTrays">0</span></td>
      </tr>
    </table>
  </div>


  <!-- 8. –ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –ª–æ—Ç–∫–∞—Ö -->
  <h3>8. –ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –ª–æ—Ç–∫–∞—Ö (–Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—ñ—Ö —è—î—Ü—å)</h3>
  <div class="table-wrapper">
    <table>
      <tr>
        <td>–£—Å—å–æ–≥–æ –ø–æ–≤–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤ (–∑ —è—î—Ü—å –¥–ª—è –ø—Ä–æ–¥–∞–∂—É)</td>
        <td class="right"><span id="totalTraysTodayLabel">0</span></td>
      </tr>
      <tr>
        <td>–ó–∞–±—Ä–æ–Ω—å–æ–≤–∞–Ω–æ –ª–æ—Ç–∫—ñ–≤ (–∞–∫—Ç–∏–≤–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è)</td>
        <td class="right"><span id="reservedTrays">0</span></td>
      </tr>
      <tr>
        <td>–í—ñ–ª—å–Ω—ñ –ª–æ—Ç–∫–∏ (–º–æ–∂–Ω–∞ –ø—Ä–æ–¥–∞—Ç–∏ —â–µ)</td>
        <td class="right"><span id="freeTrays">0</span></td>
      </tr>
    </table>
  </div>

    <!-- 9. –ó–∞–ø–∞—Å–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —ñ –ø–ª–∞–Ω –∑–∞–∫—É–ø—ñ–≤–ª—ñ -->
  <h2>9. –ó–∞–ø–∞—Å–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —ñ –ø–ª–∞–Ω –∑–∞–∫—É–ø—ñ–≤–ª—ñ</h2>
  <p class="small">
    –í–∫–∞–∂–∏, —Å–∫—ñ–ª—å–∫–∏ –∫–≥ –∫–æ–∂–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —î –∑–∞—Ä–∞–∑ –Ω–∞ —Å–∫–ª–∞–¥—ñ. 
    –ü—Ä–æ–≥—Ä–∞–º–∞ –ø–æ—Ä–∞—Ö—É—î, —Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞ 30 –¥–Ω—ñ–≤, 
    —ñ —Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–∫—É–ø–∏—Ç–∏, –≤–∏—Ö–æ–¥—è—á–∏ –∑ –Ω–æ—Ä–º–∏ –≥–æ–¥—ñ–≤–ª—ñ —Ç–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—Ç–∞—Ö—ñ–≤.
  </p>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
          <th>–ó–∞–ø–∞—Å, –∫–≥ (—î –∑–∞—Ä–∞–∑)</th>
          <th>–ü–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞ 30 –¥–Ω—ñ–≤, –∫–≥</th>
          <th>–î–æ–∫—É–ø–∏—Ç–∏, –∫–≥</th>
        </tr>
      </thead>
      <tbody id="stockRows">
        <tr data-key="corn">
          <td>–ö—É–∫—É—Ä—É–¥–∑–∞</td>
          <td class="right">
            <input type="number" class="stock" data-key="corn" id="stock_corn" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="wheat">
          <td>–ü—à–µ–Ω–∏—Ü—è</td>
          <td class="right">
            <input type="number" class="stock" data-key="wheat" id="stock_wheat" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="barley">
          <td>–Ø—á–º—ñ–Ω—å</td>
          <td class="right">
            <input type="number" class="stock" data-key="barley" id="stock_barley" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="soy">
          <td>–°–æ—î–≤–∞ –º–∞–∫—É—Ö–∞</td>
          <td class="right">
            <input type="number" class="stock" data-key="soy" id="stock_soy" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="sunflower">
          <td>–°–æ–Ω—è—à–Ω–∏–∫–æ–≤–∞ –º–∞–∫—É—Ö–∞</td>
          <td class="right">
            <input type="number" class="stock" data-key="sunflower" id="stock_sunflower" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="fishmeal">
          <td>–†–∏–±–Ω–µ –±–æ—Ä–æ—à–Ω–æ / –º'—è—Å–æ–∫—ñ—Å—Ç–∫–æ–≤–µ</td>
          <td class="right">
            <input type="number" class="stock" data-key="fishmeal" id="stock_fishmeal" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="yeast">
          <td>–ö–æ—Ä–º–æ–≤—ñ –¥—Ä—ñ–∂–¥–∂—ñ</td>
          <td class="right">
            <input type="number" class="stock" data-key="yeast" id="stock_yeast" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="tcp">
          <td>–¢—Ä–∏–∫–∞–ª—å—Ü—ñ–π—Ñ–æ—Å—Ñ–∞—Ç</td>
          <td class="right">
            <input type="number" class="stock" data-key="tcp" id="stock_tcp" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="dolfos">
          <td>–î–æ–ª—å—Ñ–æ—Å D</td>
          <td class="right">
            <input type="number" class="stock" data-key="dolfos" id="stock_dolfos" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
        <tr data-key="salt">
          <td>–°—ñ–ª—å</td>
          <td class="right">
            <input type="number" class="stock" data-key="salt" id="stock_salt" step="0.1" value="0" style="width:80px;">
          </td>
          <td class="right"><span class="need">0.0</span></td>
          <td class="right"><span class="buy">0.0</span></td>
        </tr>
      </tbody>
    </table>
  </div>

    <!-- 9.1 –°–∫–ª–∞–¥ –≥–æ—Ç–æ–≤–æ–≥–æ –∫–æ–º–±—ñ–∫–æ—Ä–º—É -->
  <h2>9.1 –°–∫–ª–∞–¥ –≥–æ—Ç–æ–≤–æ–≥–æ –∫–æ–º–±—ñ–∫–æ—Ä–º—É</h2>
  <p class="small">
    –û–±–ª—ñ–∫ —Ç–æ–≥–æ, —Å–∫—ñ–ª—å–∫–∏ –≤–∂–µ –Ω–∞–º—ñ—à–∞–Ω–æ –≥–æ—Ç–æ–≤–æ–≥–æ –∫–æ–º–±—ñ–∫–æ—Ä–º—É —Ç–∞ –Ω–∞ —Å–∫—ñ–ª—å–∫–∏ –¥–Ω—ñ–≤ –π–æ–≥–æ –≤–∏—Å—Ç–∞—á–∏—Ç—å.
  </p>

  <p>
    –ì–æ—Ç–æ–≤–∏–π –∫–æ–º–±—ñ–∫–æ—Ä–º –Ω–∞ —Å–∫–ª–∞–¥—ñ, –∫–≥:
    <span id="feedReadyStock">0.0</span>
  </p>
  <p>
    –í–∞–≥–∞ –æ–¥–Ω—ñ—î—ó –ø–∞—Ä—Ç—ñ—ó (–∑–∞ —Ä–µ—Ü–µ–ø—Ç–æ–º), –∫–≥:
    <input type="number" id="feedBatchSize" value="25" step="1" style="width:80px;">
  </p>
  <button class="btn" id="produceFeedBatch">–í–∏–≥–æ—Ç–æ–≤–∏—Ç–∏ –ø–∞—Ä—Ç—ñ—é –∫–æ–º–±—ñ–∫–æ—Ä–º—É</button>
  <button class="btn" id="consumeDailyFeed">–°–ø–∏—Å–∞—Ç–∏ –¥–æ–±–æ–≤—É –Ω–æ—Ä–º—É (–∑–≥—ñ–¥–Ω–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—Ç–∞—Ö—ñ–≤)</button>


  <!-- 10. –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è (–µ–∫—Å–ø–æ—Ä—Ç / —ñ–º–ø–æ—Ä—Ç) -->
  <h2>10. –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è (–µ–∫—Å–ø–æ—Ä—Ç / —ñ–º–ø–æ—Ä—Ç)</h2>
  <p class="small">
    –¢—É—Ç –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –±–µ–∫–∞–ø —É—Å—ñ—Ö –¥–∞–Ω–∏—Ö (—Å—Ç–∞–Ω, —â–æ–¥–µ–Ω–Ω–∏–∫, –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è) —É –≤–∏–≥–ª—è–¥—ñ —Ç–µ–∫—Å—Ç—É.
    –ü–æ—Ç—ñ–º —Ü–µ–π —Ç–µ–∫—Å—Ç –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞ —ñ–Ω—à–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó –∞–±–æ –ø—ñ—Å–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è –±—Ä–∞—É–∑–µ—Ä–∞.
  </p>
  <p>
    <button class="btn" id="backupExport">–ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö —É —Ç–µ–∫—Å—Ç</button>
    <button class="btn" id="backupImport">–Ü–º–ø–æ—Ä—Ç —ñ–∑ —Ç–µ–∫—Å—Ç—É</button>
    <button onclick="googleBackup()">–†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤ Google Drive</button>
    <button onclick="googleRestore()">–í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ Google Drive</button>
  </p>
  <textarea id="backupArea" rows="6" style="width:100%;"></textarea>
  
  <h3>–†–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è –≤ Google Drive</h3>
<button id="btnDriveLogin" type="button">üîë –£–≤—ñ–π—Ç–∏ –≤ Google</button>
<button id="btnDriveBackup" type="button" disabled>‚¨Ü –ó–±–µ—Ä–µ–≥—Ç–∏ –±–µ–∫–∞–ø —É Drive</button>
<button id="btnDriveRestore" type="button" disabled>‚¨á –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±–µ–∫–∞–ø –∑ Drive</button>
<p class="small">
–ë—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ñ–∞–π–ª <code>quail_calculator_backup.json</code> —É —Ç–≤–æ—î–º—É Google Drive (–ø–∞–ø–∫–∞ ¬´–ú—ñ–π –¥–∏—Å–∫¬ª).
</p>

    <!-- 11. –Ü–Ω–∫—É–±–∞—Ü—ñ—è –ø–∞—Ä—Ç—ñ–π —è—î—Ü—å -->
  <h2 id="incubationSection">11. –Ü–Ω–∫—É–±–∞—Ü—ñ—è</h2>
  <p class="small">
    –¢—É—Ç –º–æ–∂–Ω–∞ –≤–µ—Å—Ç–∏ –æ–±–ª—ñ–∫ –ø–∞—Ä—Ç—ñ–π –≤ —ñ–Ω–∫—É–±–∞—Ç–æ—Ä—ñ: –∫–æ–ª–∏ –∑–∞–∫–ª–∞–ª–∏, —Å–∫—ñ–ª—å–∫–∏ —è—î—Ü—å, 
    —Å–∫—ñ–ª—å–∫–∏ –≤–∏—è–≤–∏–ª–æ—Å—å –Ω–µ–∑–∞–ø–ª—ñ–¥–Ω–µ–Ω–∏—Ö –ø—Ä–∏ –æ–≤–æ—Å–∫–æ–ø—ñ—ó, —Å–∫—ñ–ª—å–∫–∏ –≤–∏–ª—É–ø–∏–ª–æ—Å—è, 
    —Å–∫—ñ–ª—å–∫–∏ –ø–æ–º–µ—Ä–ª–æ –≤ —ñ–Ω–∫—É–±–∞—Ç–æ—Ä—ñ —Ç–∞ –≤ –±—Ä—É–¥–µ—Ä—ñ.
  </p>

  <h3>11.1. –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –ø–∞—Ä—Ç—ñ—é</h3>
  <p>
    –ù–∞–∑–≤–∞ / –Ω–æ–º–µ—Ä –ø–∞—Ä—Ç—ñ—ó:
    <input type="text" id="incBatchName" style="width:160px;" placeholder="–ü–∞—Ä—Ç—ñ—è ‚Ññ3">
  </p>
  <p>
    –î–∞—Ç–∞ –∑–∞–∫–ª–∞–¥–∫–∏:
    <input type="date" id="incStartDate">
  </p>
  <p>
    –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–∫–ª–∞–¥–µ–Ω–∏—Ö —è—î—Ü—å:
    <input type="number" id="incEggsSet" value="0" step="1" style="width:80px;">
  </p>
  <p>
    –ù–æ—Ç–∞—Ç–∫–∞ (—ñ–Ω–∫—É–±–∞—Ç–æ—Ä, —Ä–µ–∂–∏–º, –ø–æ—Ä–æ–¥–∞ —Ç–æ—â–æ):
    <br>
    <textarea id="incNote" rows="2" style="width:100%;"></textarea>
  </p>
  <button class="btn" id="addIncubation">–î–æ–¥–∞—Ç–∏ –ø–∞—Ä—Ç—ñ—é</button>

  <h3>11.2. –°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç—ñ–π</h3>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ü–∞—Ä—Ç—ñ—è</th>
          <th>–î–∞—Ç–∞ –∑–∞–∫–ª–∞–¥–∫–∏</th>
          <th>–î–Ω—ñ–≤ –≤—ñ–¥ –∑–∞–∫–ª–∞–¥–∫–∏</th>
          <th>–ó–∞–∫–ª–∞–¥–µ–Ω–æ —è—î—Ü—å</th>
          <th>–ù–µ–∑–∞–ø–ª—ñ–¥–Ω–µ–Ω—ñ (–æ–≤–æ—Å–∫–æ–ø—ñ—è)</th>
          <th>–í–∏–ª—É–ø–∏–ª–æ—Å—è</th>
          <th>–ü–æ–º–µ—Ä–ª–∏ –≤ —ñ–Ω–∫—É–±–∞—Ç–æ—Ä—ñ</th>
          <th>–ü–æ–º–µ—Ä–ª–∏ –≤ –±—Ä—É–¥–µ—Ä—ñ</th>
          <th>–ñ–∏–≤—ñ –∑–∞—Ä–∞–∑</th>
          <th>–ù–æ—Ç–∞—Ç–∫–∞</th>
          <th>–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody id="incubationBody">
      </tbody>
    </table>
  </div>

    <!-- 12. –ö–ª—ñ—î–Ω—Ç–∏ (–∑–≤–µ–¥–µ–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è) -->
  <h2>12. –ö–ª—ñ—î–Ω—Ç–∏</h2>
  <p class="small">
    –ó–≤–µ–¥–µ–Ω–Ω—è –ø–æ –≤—Å—ñ—Ö –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö: —Å–∫—ñ–ª—å–∫–∏ –ª–æ—Ç–∫—ñ–≤ —Ç–∞ —è—î—Ü—å –∫—É–ø–∏–≤ –∫–æ–∂–µ–Ω –∫–ª—ñ—î–Ω—Ç 
    —ñ –Ω–∞ —è–∫—É —Å—É–º—É.
  </p>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ö–ª—ñ—î–Ω—Ç</th>
          <th>–ö-—Å—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω—å</th>
          <th>–õ–æ—Ç–∫—ñ–≤ (20 —è—î—Ü—å)</th>
          <th>–Ø—î—Ü—å</th>
          <th>–°—É–º–∞, –≥—Ä–Ω</th>
          <th>–û—Å—Ç–∞–Ω–Ω—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
        </tr>
      </thead>
      <tbody id="clientsBody">
      </tbody>
    </table>
  </div>


  <script>
       // --- –ü–†–ï–°–ï–¢–ò –†–ï–¶–ï–ü–¢–Ü–í –ö–û–†–ú–£ ---
    const recipePresets = {
      // –ü–æ—Ç–æ—á–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç (25 –∫–≥)
      universal: {
        corn: 10.0,
        wheat: 5.0,
        barley: 1.5,
        soy: 3.0,
        sunflower: 2.5,
        fishmeal: 1.0,
        yeast: 0.7,
        tcp: 0.5,
        dolfos: 0.7,
        salt: 0.05
      },
      // –¢—Ä–æ—Ö–∏ –±—ñ–ª—å—à –±—ñ–ª–∫–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç (–¥–ª—è –Ω–µ—Å—É—á–æ–∫)
      high_protein: {
        corn: 9.0,
        wheat: 4.0,
        barley: 1.0,
        soy: 4.0,
        sunflower: 3.0,
        fishmeal: 1.2,
        yeast: 0.8,
        tcp: 0.5,
        dolfos: 0.7,
        salt: 0.05
      },
      // –ï–∫–æ–Ω–æ–º–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç (–º–µ–Ω—à–µ –±—ñ–ª–∫–∞, –±—ñ–ª—å—à–µ –∑–µ—Ä–Ω–∞)
      economy: {
        corn: 11.0,
        wheat: 6.0,
        barley: 2.0,
        soy: 2.0,
        sunflower: 2.0,
        fishmeal: 0.5,
        yeast: 0.5,
        tcp: 0.5,
        dolfos: 0.7,
        salt: 0.05
      }
    };
    
        // --- –ü–ê–°–ü–û–†–¢ –ü–ê–†–¢–Ü–ô ---

    function recalcFlocksPassport() {
      const hens1 = parseInt(document.getElementById('hens1').value) || 0;
      const hens2 = parseInt(document.getElementById('hens2').value) || 0;

      const date1 = document.getElementById('hens1Date').value;
      const date2 = document.getElementById('hens2Date').value;

      updateFlockRow('hens1', hens1, date1);
      updateFlockRow('hens2', hens2, date2);
    }

    function updateFlockRow(prefix, hensCount, dateStr) {
      const dateLabel = document.getElementById(prefix + 'DateLabel');
      const ageSpan = document.getElementById(prefix + 'Age');
      const countSpan = document.getElementById(prefix + 'CountLabel');
      const commentSpan = document.getElementById(prefix + 'Comment');

      if (countSpan) countSpan.textContent = hensCount;

      if (!dateStr) {
        if (dateLabel) dateLabel.textContent = '-';
        if (ageSpan) ageSpan.textContent = '-';
        if (commentSpan) commentSpan.textContent = '–î–∞—Ç–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞.';
        return;
      }

      const d = new Date(dateStr);
      if (isNaN(d)) {
        if (dateLabel) dateLabel.textContent = dateStr;
        if (ageSpan) ageSpan.textContent = '?';
        if (commentSpan) commentSpan.textContent = '–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ –¥–∞—Ç–∞.';
        return;
      }

      const today = new Date();
      const diffMs = today.getTime() - d.getTime();
      const ageDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

      if (dateLabel) dateLabel.textContent = dateStr;
      if (ageSpan) ageSpan.textContent = ageDays.toString();

      let text = '';
      if (ageDays < 35) text = '–ú–æ–ª–æ–¥–∫–∞, —â–µ –Ω–∞—Ä–æ—â—É—î –Ω–µ—Å—É—á—ñ—Å—Ç—å.';
      else if (ageDays < 180) text = '–†–æ–±–æ—á–∞ –Ω–µ—Å—É—á—ñ—Å—Ç—å.';
      else text = '–°—Ç–∞–¥–æ —Å—Ç–∞—Ä—ñ—î, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –º–æ–∂–µ –ø–∞–¥–∞—Ç–∏.';

      if (commentSpan) commentSpan.textContent = text;
    }

    function applyRecipePreset(name) {
      const preset = recipePresets[name];
      if (!preset) return;

      const rows = document.querySelectorAll('#rows tr');
      rows.forEach(row => {
        const priceInput = row.querySelector('.price');
        const qtyCell = row.querySelector('.qty');
        if (!priceInput || !qtyCell) return;

        const key = priceInput.dataset.key; // corn, wheat, barley, soy...
        if (preset[key] !== undefined) {
          qtyCell.textContent = preset[key].toString();
        }
      });

      recalcAll();
      saveState();
    }
    
       // --- –ü–†–û–ì–ù–û–ó –ù–ê 30 –î–ù–Ü–í ---

    function recalcForecast30() {
      const hens1 = parseInt(document.getElementById('hens1').value) || 0;
      const hens2 = parseInt(document.getElementById('hens2').value) || 0;
      const hensTotal = hens1 + hens2;

      const prodAvg = parseFloat(document.getElementById('repProdAvg').textContent) || 0;
      const trayPrice = parseFloat(document.getElementById('trayPrice').value) || 0;
      const dailyFeedCost = parseFloat(document.getElementById('dailyCost').textContent) || 0;

      if (hensTotal <= 0 || prodAvg <= 0 || trayPrice <= 0) {
        // –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞—î–º–æ
        document.getElementById('fcastEggs').textContent = '0';
        document.getElementById('fcastTrays').textContent = '0';
        document.getElementById('fcastIncome').textContent = '0.00';
        document.getElementById('fcastFeedCost').textContent = '0.00';
        document.getElementById('fcastProfit').textContent = '0.00';
        return;
      }

      const eggsPerDay = hensTotal * (prodAvg / 100);
      const eggs30 = eggsPerDay * 30;
      const trays30 = Math.floor(eggs30 / 20);
      const income30 = trays30 * trayPrice;
      const feedCost30 = dailyFeedCost * 30;
      const profit30 = income30 - feedCost30;

      document.getElementById('fcastEggs').textContent = Math.round(eggs30).toString();
      document.getElementById('fcastTrays').textContent = trays30.toString();
      document.getElementById('fcastIncome').textContent = income30.toFixed(2);
      document.getElementById('fcastFeedCost').textContent = feedCost30.toFixed(2);
      document.getElementById('fcastProfit').textContent = profit30.toFixed(2);
    } 

    
    // --- –†–û–ó–†–ê–•–£–ù–û–ö –ö–û–†–ú–£ ---
    function recalcFeed() {
      const rows = document.querySelectorAll('#rows tr');
      let totalCost = 0;
      let totalQty = 0;

      rows.forEach(row => {
        const qty = parseFloat(row.querySelector('.qty').textContent) || 0;
        const priceInput = row.querySelector('.price');
        const price = parseFloat(priceInput.value) || 0;
        const sumCell = row.querySelector('.sum');
        const sum = qty * price;
        sumCell.textContent = sum.toFixed(2);
        totalCost += sum;
        totalQty += qty;
      });

      document.getElementById('totalCost').textContent = totalCost.toFixed(2);
      document.getElementById('totalQty').textContent = totalQty.toFixed(2);

      const pricePerKg = totalQty > 0 ? totalCost / totalQty : 0;
      document.getElementById('pricePerKg').textContent = pricePerKg.toFixed(2);

      const birds = parseFloat(document.getElementById('birds').value) || 0;
      const dailyNorm = parseFloat(document.getElementById('dailyNorm').value) || 0;
      const dailyFeedKg = birds * dailyNorm;
      document.getElementById('dailyFeedKg').textContent = dailyFeedKg.toFixed(3);

      const dailyCost = dailyFeedKg * pricePerKg;
      document.getElementById('dailyCost').textContent = dailyCost.toFixed(2);

      const monthlyCost = dailyCost * 30;
      document.getElementById('monthlyCost').textContent = monthlyCost.toFixed(2);

      const daysFromBag = dailyFeedKg > 0 ? totalQty / dailyFeedKg : 0;
      document.getElementById('daysFromBag').textContent = daysFromBag.toFixed(1);
    }

        // --- –ó–ê–ü–ê–°–ò –ö–û–ú–ü–û–ù–ï–ù–¢–Ü–í –Ü –ü–õ–ê–ù –ó–ê–ö–£–ü–Ü–í–õ–Ü ---
    function recalcStocks() {
      const birds = parseFloat(document.getElementById('birds').value) || 0;
      const dailyNorm = parseFloat(document.getElementById('dailyNorm').value) || 0;

      // –¥–æ–±–æ–≤–∞ –ø–æ—Ç—Ä–µ–±–∞ –≤ –∫–æ—Ä–º—ñ, –∫–≥
      const dailyFeedKg = birds * dailyNorm; // –Ω–æ—Ä–º–∞ –≤ –≥—Ä–∞–º–∞—Ö

      const days = 30;
      const totalFeedNeeded = dailyFeedKg * days; // —Å–∫—ñ–ª—å–∫–∏ –∫–≥ –∫–æ–º–±—ñ–∫–æ—Ä–º—É —Ç—Ä–µ–±–∞ –Ω–∞ 30 –¥–Ω—ñ–≤

      // —á–∏—Ç–∞—î–º–æ —Ä–µ—Ü–µ–ø—Ç (—Å–∫—ñ–ª—å–∫–∏ –∫–≥ –∫–æ–∂–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤ 25 –∫–≥)
      const rows = document.querySelectorAll('#rows tr');
      const recipe = {};
      let totalQty = 0;

      rows.forEach(row => {
        const qtyCell = row.querySelector('.qty');
        const priceInput = row.querySelector('.price');
        if (!qtyCell || !priceInput) return;

        const qty = parseFloat(qtyCell.textContent) || 0;
        const key = priceInput.dataset.key || '';
        if (!key) return;

        recipe[key] = qty;
        totalQty += qty;
      });

      const stockRows = document.querySelectorAll('#stockRows tr');
      stockRows.forEach(row => {
        const key = row.dataset.key;
        const needSpan = row.querySelector('.need');
        const buySpan = row.querySelector('.buy');
        const stockInput = row.querySelector('.stock');

        if (!key || !needSpan || !buySpan || !stockInput) return;

        const haveKg = parseFloat(stockInput.value) || 0;

        let needKg = 0;
        if (totalFeedNeeded > 0 && totalQty > 0 && recipe[key] !== undefined) {
          const ratio = recipe[key] / totalQty; // —á–∞—Å—Ç–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤ —Ä–µ—Ü–µ–ø—Ç—ñ
          needKg = totalFeedNeeded * ratio;
        }

        const toBuy = Math.max(needKg - haveKg, 0);

        needSpan.textContent = needKg.toFixed(1);
        buySpan.textContent = toBuy.toFixed(1);
      });
    }

        // --- –°–ö–õ–ê–î –ì–û–¢–û–í–û–ì–û –ö–û–ú–ë–Ü–ö–û–†–ú–£ ---
    function loadFeedReadyStock() {
      const raw = localStorage.getItem('quailFeedReadyStock');
      return raw ? (parseFloat(raw) || 0) : 0;
    }

    function saveFeedReadyStock(value) {
      localStorage.setItem('quailFeedReadyStock', String(value));
    }

    function renderFeedReadyStock() {
      const span = document.getElementById('feedReadyStock');
      if (!span) return;
      span.textContent = loadFeedReadyStock().toFixed(1);
    }

    function produceFeedBatch() {
      const sizeInput = document.getElementById('feedBatchSize');
      const batchSize = sizeInput ? (parseFloat(sizeInput.value) || 0) : 0;
      if (batchSize <= 0) {
        alert('–í–∫–∞–∂–∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—É –≤–∞–≥—É –ø–∞—Ä—Ç—ñ—ó, –∫–≥');
        return;
      }
      const current = loadFeedReadyStock();
      const total = current + batchSize;
      saveFeedReadyStock(total);
      renderFeedReadyStock();
      updateWarnings();
    }

    function consumeDailyFeed() {
      const birds = parseInt(document.getElementById('birds')?.value || '0') || 0;
      const norm = parseFloat(document.getElementById('dailyNorm')?.value || '0') || 0;
      const daily = birds * norm;
      if (daily <= 0) {
        alert('–ù–µ–≤—ñ—Ä–Ω–æ –∑–∞–¥–∞–Ω—ñ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ç–∞—Ö—ñ–≤ –∞–±–æ –¥–æ–±–æ–≤–∞ –Ω–æ—Ä–º–∞.');
        return;
      }
      let current = loadFeedReadyStock();
      current -= daily;
      if (current < 0) current = 0;
      saveFeedReadyStock(current);
      renderFeedReadyStock();
      updateWarnings();
    }


        // --- –§–Ü–ù–ê–ù–°–û–í–ò–ô –ó–í–Ü–¢ –ó–ê –ü–ï–†–Ü–û–î ---
    function recalcReport() {
      const periodSelect = document.getElementById('reportPeriod');
      if (!periodSelect) return;

      const period = periodSelect.value; // "7", "30" –∞–±–æ "all"
      const log = loadLog();

      // –Ø–∫—â–æ —â–æ–¥–µ–Ω–Ω–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–±–Ω—É–ª—è—î–º–æ
      if (!log.length) {
        document.getElementById('repDays').textContent = '0';
        document.getElementById('repEggs').textContent = '0';
        document.getElementById('repTrays').textContent = '0';
        document.getElementById('repIncome').textContent = '0.00';
        document.getElementById('repFeedCost').textContent = '0.00';
        document.getElementById('repProfit').textContent = '0.00';
        document.getElementById('repProdAvg').textContent = '0.0';
        document.getElementById('repCostPerEgg').textContent = '0.000';
        document.getElementById('repProfitPerEgg').textContent = '0.000';
        document.getElementById('repProfitPerHen').textContent = '0.00';
        return;
      }

      const today = new Date();
      let fromDate = null;

      if (period !== 'all') {
        const days = parseInt(period, 10) || 0;
        // –Ω–∞–ø—Ä. –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤: today-6 ... today
        fromDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - days + 1);
      }

      let daysCount = 0;
      let eggs = 0;
      let trays = 0;
      let income = 0;
      let feedCost = 0;
      let profit = 0;

      let prodSum = 0;
      let prodCount = 0;

      log.forEach(entry => {
        if (!entry.date) return;
        const d = new Date(entry.date);
        if (isNaN(d)) return;

        if (fromDate && d < fromDate) return;

        daysCount++;
        eggs += entry.eggsTotal || 0;
        trays += entry.trays || 0;
        income += entry.income || 0;
        feedCost += entry.dailyCost || 0;

        // —è–∫—â–æ –≤ –∑–∞–ø–∏—Å—ñ –Ω–µ–º–∞ profit ‚Äî –ø–µ—Ä–µ—Ä–∞—Ö—É—î–º–æ
        const p = (typeof entry.profit === 'number')
          ? entry.profit
          : (entry.income || 0) - (entry.dailyCost || 0);
        profit += p;

        if (typeof entry.productivity === 'number') {
          prodSum += entry.productivity;
          prodCount++;
        }
      });

      const prodAvg = prodCount ? (prodSum / prodCount) : 0;
      const costPerEgg = eggs > 0 ? (feedCost / eggs) : 0;
      const profitPerEgg = eggs > 0 ? (profit / eggs) : 0;
      const otherInput = document.getElementById('otherCostsMonthly');
      const otherMonthly = otherInput ? (parseFloat(otherInput.value) || 0) : 0;
      let otherCostPeriod = 0;
      if (daysCount > 0 && otherMonthly > 0) {
      otherCostPeriod = otherMonthly * (daysCount / 30);
      }

      const fullCostPerEgg = eggs > 0 ? ((feedCost + otherCostPeriod) / eggs) : 0;
      const profitPerEggFull = eggs > 0 ? ((income - feedCost - otherCostPeriod) / eggs) : 0;


      const hens1El = document.getElementById('hens1');
      const hens2El = document.getElementById('hens2');
      const hensTotal = (parseInt(hens1El ? hens1El.value : '0') || 0) +
                        (parseInt(hens2El ? hens2El.value : '0') || 0);
      const profitPerHen = hensTotal > 0 ? (profit / hensTotal) : 0;

      document.getElementById('repDays').textContent = daysCount.toString();
      document.getElementById('repEggs').textContent = eggs.toString();
      document.getElementById('repTrays').textContent = trays.toString();
      document.getElementById('repIncome').textContent = income.toFixed(2);
      document.getElementById('repFeedCost').textContent = feedCost.toFixed(2);
      document.getElementById('repProfit').textContent = profit.toFixed(2);
      document.getElementById('repProdAvg').textContent = prodAvg.toFixed(1);
      document.getElementById('repCostPerEgg').textContent = costPerEgg.toFixed(3);
      document.getElementById('repProfitPerEgg').textContent = profitPerEgg.toFixed(3);
      document.getElementById('repProfitPerHen').textContent = profitPerHen.toFixed(2);
      document.getElementById('repOtherCost').textContent = otherCostPeriod.toFixed(2);
      document.getElementById('repFullCostPerEgg').textContent = fullCostPerEgg.toFixed(3);
      document.getElementById('repProfitPerEggFull').textContent = profitPerEggFull.toFixed(3);
      document.getElementById('repProfitPerEggFull').textContent = profitPerEggFull.toFixed(3);

      recalcForecast30();

    }


    // --- –†–û–ó–†–ê–•–£–ù–û–ö –Ø–Ñ–¶–¨ ---
    function recalcEggs() {
  const eggsTotal = parseInt(document.getElementById('eggsTotal').value) || 0;
  const eggsBad = parseInt(document.getElementById('eggsBad').value) || 0;
  const eggsOwn = parseInt(document.getElementById('eggsOwn').value) || 0;
  const trayPrice = parseFloat(document.getElementById('trayPrice').value) || 0;
  const eggsCarry = parseInt(document.getElementById('eggsCarry').value) || 0;

  // –Ø–π—Ü—è, —è–∫—ñ –∑'—è–≤–∏–ª–∏—Å—è –°–¨–û–ì–û–î–ù–Ü –¥–ª—è –ø—Ä–æ–¥–∞–∂—É
  const eggsForSaleToday = Math.max(eggsTotal - eggsBad - eggsOwn, 0);

  // –£—Å—å–æ–≥–æ —è—î—Ü—å, –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–ª—è –ø—Ä–æ–¥–∞–∂—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–∞–ª–∏—à–∫—É
  const eggsForSaleTotal = Math.max(eggsCarry + eggsForSaleToday, 0);

  const trays = Math.floor(eggsForSaleTotal / 20);
  const income = trays * trayPrice;
  const remainder = eggsForSaleTotal - trays * 20;

  document.getElementById('eggsForSale').textContent = eggsForSaleToday;
  document.getElementById('eggsForSaleTotal').textContent = eggsForSaleTotal;
  document.getElementById('traysCount').textContent = trays;
  document.getElementById('eggsRemainder').textContent = remainder;
  document.getElementById('income').textContent = income.toFixed(2);

  // –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø–æ —Å—Ç–∞–¥—É
  const hens1 = parseInt(document.getElementById('hens1').value) || 0;
  const hens2 = parseInt(document.getElementById('hens2').value) || 0;
  const hensTotal = hens1 + hens2;
  const productivity = hensTotal > 0 ? (eggsTotal / hensTotal) * 100 : 0;

  document.getElementById('hensTotal').textContent = hensTotal;
  document.getElementById('productivityToday').textContent = productivity.toFixed(1);
}

    // --- –ü–Ü–î–°–£–ú–û–ö –î–ù–Ø ---
    function recalcSummary() {
      const dailyCost = parseFloat(document.getElementById('dailyCost').textContent) || 0;
      const income = parseFloat(document.getElementById('income').textContent) || 0;
      const profit = income - dailyCost;

      document.getElementById('summaryFeedCost').textContent = dailyCost.toFixed(2);
      document.getElementById('summaryEggIncome').textContent = income.toFixed(2);
      document.getElementById('summaryProfit').textContent = profit.toFixed(2);
    }

    // --- –ü–Ü–î–°–£–ú–û–ö –õ–û–¢–ö–Ü–í ---
    function updateTrayStats() {
      const totalTraysToday = parseInt(document.getElementById('traysCount').textContent) || 0;
      const orders = loadOrders();
      let reserved = 0;
      orders.forEach(o => {
        if (!o.done) {
          reserved += o.trays;
        }
      });
      document.getElementById('totalTraysTodayLabel').textContent = totalTraysToday;
      document.getElementById('reservedTrays').textContent = reserved;
      const free = Math.max(totalTraysToday - reserved, 0);
      document.getElementById('freeTrays').textContent = free;
    }

      function recalcAll() {
      recalcFeed();
      recalcEggs();
      recalcSummary();
      updateTrayStats();
      recalcStocks();
      recalcReport();
      updateDashboard();
      updateWarnings();
      renderCharts();
      recalcFlocksPassport();
      recalcForecast30();
    }

      function updateOrdersSummary() {
      const orders = loadOrders();
      let activeCount = 0, doneCount = 0;
      let activeTrays = 0, doneTrays = 0;

      orders.forEach(o => {
        if (o.done) {
          doneCount++;
          doneTrays += o.trays || 0;
        } else {
          activeCount++;
          activeTrays += o.trays || 0;
        }
      });

      const aC = document.getElementById('ordersActiveCount');
      const dC = document.getElementById('ordersDoneCount');
      const aT = document.getElementById('ordersActiveTrays');
      const dT = document.getElementById('ordersDoneTrays');

      if (aC) aC.textContent = activeCount;
      if (dC) dC.textContent = doneCount;
      if (aT) aT.textContent = activeTrays;
      if (dT) dT.textContent = doneTrays;
    }

    
    // --- –ì–û–õ–û–í–ù–ê –ü–ê–ù–ï–õ–¨ ---
    function updateDashboard() {
      const eggsInput = document.getElementById('eggsTotal');
      const eggsToday = eggsInput ? (parseInt(eggsInput.value) || 0) : 0;

      const freeTraysSpan = document.getElementById('freeTrays');
      const freeTrays = freeTraysSpan ? (parseInt(freeTraysSpan.textContent) || 0) : 0;

      const orders = typeof loadOrders === 'function' ? loadOrders() : [];
      const activeOrders = orders.filter(o => !o.done).length;

      const prodSpan = document.getElementById('repProdAvg');
      const prodAvg = prodSpan ? (parseFloat(prodSpan.textContent) || 0) : 0;

      const dEggs = document.getElementById('dashEggsToday');
      const dFree = document.getElementById('dashFreeTrays');
      const dAct = document.getElementById('dashActiveOrders');
      const dProd = document.getElementById('dashProdAvg');

      if (dEggs) dEggs.textContent = eggsToday;
      if (dFree) dFree.textContent = freeTrays;
      if (dAct) dAct.textContent = activeOrders;
      if (dProd) dProd.textContent = prodAvg.toFixed(1);
    }

      // --- –ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø ---
      function updateWarnings() {
      const container = document.getElementById('topWarnings');
      if (!container) return;
      container.innerHTML = '';

      function addWarn(text, type) {
        const div = document.createElement('div');
        div.textContent = text;
        div.className = 'warn-item ' + (type || 'warn-warn');
        container.appendChild(div);
      }

      // 1) –ù–µ—Å—É—á—ñ—Å—Ç—å
      const prodSpan = document.getElementById('repProdAvg');
      const prodAvg = prodSpan ? (parseFloat(prodSpan.textContent) || 0) : 0;
      if (prodAvg > 0 && prodAvg < 70) {
        addWarn('‚ö† –ù–µ—Å—É—á—ñ—Å—Ç—å –∑–∞ –ø–µ—Ä—ñ–æ–¥ –Ω–∏–∂—á–∞ 70%. –ü–µ—Ä–µ–≤—ñ—Ä –∫–æ—Ä–º / —Å–≤—ñ—Ç–ª–æ / —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É.', 'warn-bad');
      }

      // 2) –õ–æ—Ç–∫–∏ vs –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
      const totalTraysToday = parseInt(document.getElementById('traysCount')?.textContent || '0') || 0;
      const reservedTrays = parseInt(document.getElementById('reservedTrays')?.textContent || '0') || 0;
      if (reservedTrays > totalTraysToday) {
        addWarn('‚ö† –ó–∞–º–æ–≤–ª–µ–Ω—å –±—ñ–ª—å—à–µ, –Ω—ñ–∂ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ª–æ—Ç–∫—ñ–≤ —Å—å–æ–≥–æ–¥–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä –ø–ª–∞–Ω –≤—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.', 'warn-bad');
      }

      // 3) –ö–æ—Ä–º/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ ‚Äì —è–∫—â–æ —É —Ç–µ–±–µ —î –±–ª–æ–∫ "–ó–∞–ø–∞—Å–∏", –º–æ–∂–Ω–∞ —Ç—É—Ç –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

      const readyStock = loadFeedReadyStock ? loadFeedReadyStock() : 0;
      const birds = parseInt(document.getElementById('birds')?.value || '0') || 0;
      const norm = parseFloat(document.getElementById('dailyNorm')?.value || '0') || 0;
      const daily = birds * norm;
      if (daily > 0 && readyStock > 0 && readyStock < daily * 3) {
        addWarn('‚ö† –ì–æ—Ç–æ–≤–æ–≥–æ –∫–æ–º–±—ñ–∫–æ—Ä–º—É –º–µ–Ω—à–µ –Ω—ñ–∂ –Ω–∞ 3 –¥–Ω—ñ.', 'warn-warn');
      }
      
      // 4) –Ø–∫—â–æ —Å—å–æ–≥–æ–¥–Ω—ñ —è—î—Ü—å 0, –∞ —Å–∞–º–∫–∏ —î
      const eggsToday = parseInt(document.getElementById('eggsTotal')?.value || '0') || 0;
      const hensTotal = parseInt(document.getElementById('hensTotal')?.textContent || '0') || 0;
      if (hensTotal > 0 && eggsToday === 0) {
        addWarn('–°—å–æ–≥–æ–¥–Ω—ñ –Ω–µ –≤–Ω–µ—Å–µ–Ω–æ —è—î—Ü—å –∞–±–æ —Ä–µ–∞–ª—å–Ω–æ 0. –ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ –≤—Å–µ –≥–∞—Ä–∞–∑–¥ –∑ –∑–∞–ø–∏—Å–∞–º–∏ / —Å—Ç–∞–¥–æ –Ω–µ –∑—É–ø–∏–Ω–∏–ª–æ—Å—å.', 'warn-warn');
      }

      
      if (container.innerHTML === '') {
        addWarn('–í—Å–µ –≤–∏–≥–ª—è–¥–∞—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ üëç', 'warn-ok');
      }
    }


       // --- –ê–í–¢–û–ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø ---
    function saveState() {
      const state = {
        prices: {},
        stocks: {},
        birds: document.getElementById('birds').value,
        dailyNorm: document.getElementById('dailyNorm').value,
        eggsTotal: document.getElementById('eggsTotal').value,
        eggsBad: document.getElementById('eggsBad').value,
        eggsOwn: document.getElementById('eggsOwn').value,
        trayPrice: document.getElementById('trayPrice').value,
        logDate: document.getElementById('logDate').value,
        logNote: document.getElementById('logNote').value,
        orderCustomer: document.getElementById('orderCustomer').value,
        orderTrays: document.getElementById('orderTrays').value,
        orderNote: document.getElementById('orderNote').value,
        hens1: document.getElementById('hens1') ? document.getElementById('hens1').value : '',
        hens2: document.getElementById('hens2') ? document.getElementById('hens2').value : '',
        eggsCarry: document.getElementById('eggsCarry') ? document.getElementById('eggsCarry').value : '',
        reportPeriod: document.getElementById('reportPeriod') ? document.getElementById('reportPeriod').value : '30',
        recipePreset: document.getElementById('recipePreset') ? document.getElementById('recipePreset').value : 'universal',
        otherCostsMonthly: document.getElementById('otherCostsMonthly').value

      };


      // —Ü—ñ–Ω–∏
      document.querySelectorAll('.price').forEach(input => {
        const key = input.dataset.key || '';
        if (key) {
          state.prices[key] = input.value;
        }
      });

      // –∑–∞–ø–∞—Å–∏
      document.querySelectorAll('.stock').forEach(input => {
        const key = input.dataset.key || '';
        if (key) {
          state.stocks[key] = input.value;
        }
      });

      localStorage.setItem('quailCalcState', JSON.stringify(state));
    }


       function loadState() {
      const raw = localStorage.getItem('quailCalcState');
      if (!raw) return;
      try {
        const state = JSON.parse(raw);

        // —Ü—ñ–Ω–∏
        if (state.prices) {
          document.querySelectorAll('.price').forEach(input => {
            const key = input.dataset.key || '';
            if (key && state.prices[key] !== undefined) {
              input.value = state.prices[key];
            }
          });
        }

        // –ó–ê–ü–ê–°–ò
        if (state.stocks) {
          document.querySelectorAll('.stock').forEach(input => {
            const key = input.dataset.key || '';
            if (key && state.stocks[key] !== undefined) {
              input.value = state.stocks[key];
            }
          });
        }

        if (state.birds !== undefined) document.getElementById('birds').value = state.birds;
        if (state.dailyNorm !== undefined) document.getElementById('dailyNorm').value = state.dailyNorm;
        if (state.eggsTotal !== undefined) document.getElementById('eggsTotal').value = state.eggsTotal;
        if (state.eggsBad !== undefined) document.getElementById('eggsBad').value = state.eggsBad;
        if (state.eggsOwn !== undefined) document.getElementById('eggsOwn').value = state.eggsOwn;
        if (state.trayPrice !== undefined) document.getElementById('trayPrice').value = state.trayPrice;
        if (state.hens1 !== undefined && document.getElementById('hens1')) document.getElementById('hens1').value = state.hens1;
        if (state.hens2 !== undefined && document.getElementById('hens2')) document.getElementById('hens2').value = state.hens2;
        if (state.eggsCarry !== undefined && document.getElementById('eggsCarry')) document.getElementById('eggsCarry').value = state.eggsCarry;

        if (state.logDate !== undefined) document.getElementById('logDate').value = state.logDate;
        if (state.logNote !== undefined) document.getElementById('logNote').value = state.logNote;
        if (state.orderCustomer !== undefined) document.getElementById('orderCustomer').value = state.orderCustomer;
        if (state.orderTrays !== undefined) document.getElementById('orderTrays').value = state.orderTrays;
        if (state.orderNote !== undefined) document.getElementById('orderNote').value = state.orderNote;   
        if (state.otherCostsMonthly) {
        document.getElementById('otherCostsMonthly').value = state.otherCostsMonthly;
        }
        if (state.reportPeriod !== undefined && document.getElementById('reportPeriod')) {
        document.getElementById('reportPeriod').value = state.reportPeriod;
        }
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Å—Ç–∞–Ω—É', e);
      }
    }


    // --- –©–û–î–ï–ù–ù–ò–ö ---
    function loadLog() {
      const raw = localStorage.getItem('quailCalcLog');
      if (!raw) return [];
      try {
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è –ª–æ–≥—ñ–≤', e);
        return [];
      }
    }

    function saveLog(log) {
      localStorage.setItem('quailCalcLog', JSON.stringify(log));
    }

        function renderLog() {
      const log = loadLog();
      const tbody = document.getElementById('logTableBody');
      tbody.innerHTML = '';

      log.forEach((entry, index) => {
        const tr = document.createElement('tr');

        const tdDate = document.createElement('td');
        tdDate.textContent = entry.date || '';
        tr.appendChild(tdDate);

        const tdEggsTotal = document.createElement('td');
        tdEggsTotal.textContent = entry.eggsTotal != null ? entry.eggsTotal : '';
        tr.appendChild(tdEggsTotal);

        const tdHensTotal = document.createElement('td');
        tdHensTotal.textContent = entry.hensTotal != null ? entry.hensTotal : '';
        tr.appendChild(tdHensTotal);

        const tdProd = document.createElement('td');
        if (typeof entry.productivity === 'number') {
          tdProd.textContent = entry.productivity.toFixed(1);
        } else {
          tdProd.textContent = '';
        }
        tr.appendChild(tdProd);

        const tdEggsForSaleToday = document.createElement('td');
        tdEggsForSaleToday.textContent =
          entry.eggsForSaleToday != null
            ? entry.eggsForSaleToday
            : (entry.eggsForSale != null ? entry.eggsForSale : '');
        tr.appendChild(tdEggsForSaleToday);

        const tdEggsForSaleTotal = document.createElement('td');
        if (entry.eggsForSaleTotal != null) {
          tdEggsForSaleTotal.textContent = entry.eggsForSaleTotal;
        } else {
          tdEggsForSaleTotal.textContent = '';
        }
        tr.appendChild(tdEggsForSaleTotal);

        const tdTrays = document.createElement('td');
        tdTrays.textContent = entry.trays != null ? entry.trays : '';
        tr.appendChild(tdTrays);

        const tdIncome = document.createElement('td');
        tdIncome.textContent =
          typeof entry.income === 'number' ? entry.income.toFixed(2) : '';
        tr.appendChild(tdIncome);

        const tdDailyCost = document.createElement('td');
        tdDailyCost.textContent =
          typeof entry.dailyCost === 'number' ? entry.dailyCost.toFixed(2) : '';
        tr.appendChild(tdDailyCost);

        const tdProfit = document.createElement('td');
        tdProfit.textContent =
          typeof entry.profit === 'number' ? entry.profit.toFixed(2) : '';
        tr.appendChild(tdProfit);

        const tdNote = document.createElement('td');
        tdNote.textContent = entry.note || '';
        tr.appendChild(tdNote);

        const tdDel = document.createElement('td');
        const btn = document.createElement('button');
        btn.textContent = '√ó';
        btn.className = 'btn btn-danger btn-small';
        btn.onclick = function () {
        const current = loadLog();
        current.splice(index, 1);
        saveLog(current);
        renderLog();
        recalcReport();
        };
        tdDel.appendChild(btn);
        tr.appendChild(tdDel);

        tbody.appendChild(tr);
      });
    }
    
        // --- –ì–†–ê–§–Ü–ö–ò –ù–ï–°–£–ß–û–°–¢–Ü –¢–ê –ü–†–û–î–ê–ñ–Ü–í ---

    function renderCharts() {
      const log = loadLog();
      if (!log.length) return;

      // –±–µ—Ä–µ–º–æ –º–∞–∫—Å–∏–º—É–º 14 –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤
      const data = log.slice(-14);
      const labels = data.map(e => e.date || '');
      const prod = data.map(e => typeof e.productivity === 'number' ? e.productivity : null);
      const trays = data.map(e => e.trays != null ? e.trays : null);
      const income = data.map(e => typeof e.income === 'number' ? e.income : null);

      drawLineChart('chartProductivity', labels, prod, '–ù–µ—Å—É—á—ñ—Å—Ç—å, %');
      drawTwoSeriesChart('chartSales', labels, trays, income, '–õ–æ—Ç–∫–∏', '–í–∏—Ä—É—á–∫–∞, –≥—Ä–Ω');
    }

    function drawLineChart(canvasId, labels, values, labelY) {
      const canvas = document.getElementById(canvasId);
      if (!canvas || !canvas.getContext) return;
      const ctx = canvas.getContext('2d');
      const w = canvas.width = canvas.clientWidth;
      const h = canvas.height;

      ctx.clearRect(0, 0, w, h);

      const valid = values.filter(v => typeof v === 'number');
      if (!valid.length) return;

      const min = Math.min.apply(null, valid);
      const max = Math.max.apply(null, valid);
      const padding = 25;
      const xStep = (w - padding * 2) / Math.max(values.length - 1, 1);

      function yScale(v) {
        if (max === min) return h / 2;
        return padding + (h - padding * 2) * (1 - (v - min) / (max - min));
      }

      // –û—Å—ñ
      ctx.strokeStyle = '#ccc';
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, h - padding);
      ctx.lineTo(w - padding, h - padding);
      ctx.stroke();

      // –õ—ñ–Ω—ñ—è
      ctx.strokeStyle = '#0077cc';
      ctx.lineWidth = 2;
      ctx.beginPath();
      values.forEach((v, i) => {
        if (typeof v !== 'number') return;
        const x = padding + xStep * i;
        const y = yScale(v);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      // –¢–æ—á–∫–∏
      ctx.fillStyle = '#0077cc';
      values.forEach((v, i) => {
        if (typeof v !== 'number') return;
        const x = padding + xStep * i;
        const y = yScale(v);
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI * 2);
        ctx.fill();
      });

      // –ü—ñ–¥–ø–∏—Å–∏ –ø–æ X
      ctx.fillStyle = '#666';
      ctx.font = '10px Arial';
      labels.forEach((lbl, i) => {
        const x = padding + xStep * i;
        ctx.fillText(lbl.slice(5), x - 12, h - 8); // –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –ú–ú-–î–î
      });

      // –ü—ñ–¥–ø–∏—Å –æ—Å—ñ Y
      ctx.fillText(labelY, 5, 10);
    }

    function drawTwoSeriesChart(canvasId, labels, series1, series2, label1, label2) {
      const canvas = document.getElementById(canvasId);
      if (!canvas || !canvas.getContext) return;
      const ctx = canvas.getContext('2d');
      const w = canvas.width = canvas.clientWidth;
      const h = canvas.height;
      ctx.clearRect(0, 0, w, h);

      const valid1 = series1.filter(v => typeof v === 'number');
      const valid2 = series2.filter(v => typeof v === 'number');
      if (!valid1.length && !valid2.length) return;

      const min = 0;
      const max = Math.max(
        valid1.length ? Math.max.apply(null, valid1) : 0,
        valid2.length ? Math.max.apply(null, valid2) : 0
      );
      const padding = 25;
      const xStep = (w - padding * 2) / Math.max(labels.length - 1, 1);

      function yScale(v) {
        if (max === min) return h / 2;
        return padding + (h - padding * 2) * (1 - (v - min) / (max - min));
      }

      // –û—Å—ñ
      ctx.strokeStyle = '#ccc';
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, h - padding);
      ctx.lineTo(w - padding, h - padding);
      ctx.stroke();

      // 1-—à–∞ —Å–µ—Ä—ñ—è ‚Äì —Å—Ç–æ–≤–ø—á–∏–∫–∏ (–ª–æ—Ç–∫–∏)
      ctx.fillStyle = '#3399ff';
      series1.forEach((v, i) => {
        if (typeof v !== 'number') return;
        const x = padding + xStep * i - 5;
        const y = yScale(v);
        const barH = (h - padding) - y;
        ctx.fillRect(x, y, 10, barH);
      });

      // 2-–≥–∞ —Å–µ—Ä—ñ—è ‚Äì –ª—ñ–Ω—ñ—è (–≤–∏—Ä—É—á–∫–∞)
      ctx.strokeStyle = '#ff6600';
      ctx.lineWidth = 2;
      ctx.beginPath();
      series2.forEach((v, i) => {
        if (typeof v !== 'number') return;
        const x = padding + xStep * i;
        const y = yScale(v);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      // –õ–µ–≥–µ–Ω–¥–∞
      ctx.fillStyle = '#333';
      ctx.font = '10px Arial';
      ctx.fillText(label1, padding + 5, padding + 10);
      ctx.fillText(label2, padding + 85, padding + 10);

      // X-labels
      ctx.fillStyle = '#666';
      labels.forEach((lbl, i) => {
        const x = padding + xStep * i;
        ctx.fillText(lbl.slice(5), x - 12, h - 8);
      });
    }

        function addToLog() {
      const date = document.getElementById('logDate').value ||
        new Date().toISOString().slice(0, 10);
      const note = document.getElementById('logNote').value || '';

      const eggsTotal = parseInt(document.getElementById('eggsTotal').value) || 0;
      const eggsForSaleToday = parseInt(document.getElementById('eggsForSale').textContent) || 0;
      const eggsForSaleTotal = parseInt(document.getElementById('eggsForSaleTotal').textContent) || eggsForSaleToday;
      const trays = parseInt(document.getElementById('traysCount').textContent) || 0;
      const income = parseFloat(document.getElementById('income').textContent) || 0;
      const dailyCost = parseFloat(document.getElementById('dailyCost').textContent) || 0;
      const profit = income - dailyCost;

      const hens1 = parseInt(document.getElementById('hens1').value) || 0;
      const hens2 = parseInt(document.getElementById('hens2').value) || 0;
      const hensTotal = hens1 + hens2;
      const productivity = hensTotal > 0 ? (eggsTotal / hensTotal) * 100 : 0;

      const log = loadLog();
      log.push({
        date,
        eggsTotal,
        eggsForSaleToday,
        eggsForSaleTotal,
        trays,
        income,
        dailyCost,
        profit,
        hensTotal,
        productivity,
        note
      });
      saveLog(log);
      renderLog();
      recalcReport();
      renderCharts();

      // –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–∏—à–æ–∫ —è—î—Ü—å –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –¥–µ–Ω—å
      document.getElementById('eggsCarry').value = eggsForSaleTotal;
      saveState();
    }

    function clearLog() {
      if (!confirm('–¢–æ—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å —â–æ–¥–µ–Ω–Ω–∏–∫?')) return;
      localStorage.removeItem('quailCalcLog');
      renderLog();
      recalcReport();
    }

        // --- –ï–ö–°–ü–û–†–¢ / –Ü–ú–ü–û–†–¢ –î–ê–ù–ò–• ---
    function backupExport() {
      const stateRaw = localStorage.getItem('quailCalcState') || '{}';
      const logRaw = localStorage.getItem('quailCalcLog') || '[]';
      const ordersRaw = localStorage.getItem('quailOrders') || '[]';

      const backup = {
        state: JSON.parse(stateRaw),
        log: JSON.parse(logRaw),
        orders: JSON.parse(ordersRaw),
        incubations: JSON.parse(incRaw)
      };

      document.getElementById('backupArea').value =
        JSON.stringify(backup, null, 2);
    }

    function backupImport() {
      const txt = document.getElementById('backupArea').value.trim();
      if (!txt) {
        alert('–í—Å—Ç–∞–≤ —Å—é–¥–∏ –¥–∞–Ω—ñ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É.');
        return;
      }
      try {
        const backup = JSON.parse(txt);
        if (backup.state) {
          localStorage.setItem('quailCalcState', JSON.stringify(backup.state));
        }
        if (backup.log) {
          localStorage.setItem('quailCalcLog', JSON.stringify(backup.log));
        }
        if (backup.orders) {
          localStorage.setItem('quailOrders', JSON.stringify(backup.orders));
        }
        if (backup.incubations) {
          localStorage.setItem('quailIncubations', JSON.stringify(backup.incubations));
        }  
        loadState();
        renderLog();
        renderOrders();
        recalcAll();
        renderIncubations();
        renderClientsSummary();
        alert('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ.');
      } catch (e) {
        console.error(e);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥–∞–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä —Ñ–æ—Ä–º–∞—Ç.');
      }
    }

    // --- –ó–ê–ú–û–í–õ–ï–ù–ù–Ø ---
    function loadOrders() {
      const raw = localStorage.getItem('quailOrders');
      if (!raw) return [];
      try {
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å', e);
        return [];
      }
    }

    function saveOrders(orders) {
      localStorage.setItem('quailOrders', JSON.stringify(orders));
    }

    function renderOrders() {
      const orders = loadOrders();
      const bodyActive = document.getElementById('ordersActiveBody');
      const bodyDone = document.getElementById('ordersDoneBody');
      bodyActive.innerHTML = '';
      bodyDone.innerHTML = '';

      orders.forEach((order, index) => {
        const tr = document.createElement('tr');

        const tdCustomer = document.createElement('td');
        tdCustomer.textContent = order.customer || '';
        tr.appendChild(tdCustomer);

        const tdEggs = document.createElement('td');
        tdEggs.textContent = order.eggs;
        tr.appendChild(tdEggs);

        const tdTrays = document.createElement('td');
        tdTrays.textContent = order.trays;
        tr.appendChild(tdTrays);

        const tdDate = document.createElement('td');
        tdDate.textContent = order.date || '';
        tr.appendChild(tdDate);

        const tdNote = document.createElement('td');
        tdNote.textContent = order.note || '';
        tr.appendChild(tdNote);

        const tdStatus = document.createElement('td');
        tdStatus.textContent = order.done ? '–í–∏–∫–æ–Ω–∞–Ω–æ' : '–ê–∫—Ç–∏–≤–Ω–µ';
        tr.appendChild(tdStatus);

        const tdActions = document.createElement('td');

        if (!order.done) {
          const btnDone = document.createElement('button');
          btnDone.textContent = '–í–∏–∫–æ–Ω–∞–Ω–æ';
          btnDone.className = 'btn btn-small';
          btnDone.onclick = function () {
            const current = loadOrders();
            if (current[index]) {
              current[index].done = true;
              saveOrders(current);
              renderOrders();
            }
          };
          tdActions.appendChild(btnDone);

          const btnDel = document.createElement('button');
          btnDel.textContent = '√ó';
          btnDel.className = 'btn btn-danger btn-small';
          btnDel.style.marginLeft = '4px';
          btnDel.onclick = function () {
            const current = loadOrders();
            current.splice(index, 1);
            saveOrders(current);
            renderOrders();
          };
          tdActions.appendChild(btnDel);

          tr.appendChild(tdActions);
          bodyActive.appendChild(tr);
        } else {
          const btnDel = document.createElement('button');
          btnDel.textContent = '√ó';
          btnDel.className = 'btn btn-danger btn-small';
          btnDel.onclick = function () {
            const current = loadOrders();
            current.splice(index, 1);
            saveOrders(current);
            renderOrders();
          };
          tdActions.appendChild(btnDel);
          tr.appendChild(tdActions);
          bodyDone.appendChild(tr);
        }
      });

      updateTrayStats();
      updateOrdersSummary();
      updateDashboard();
      updateWarnings();
      renderClientsSummary();
      
      
    }

    // --- –ó–í–ï–î–ï–ù–ù–Ø –ü–û –ö–õ–Ü–Ñ–ù–¢–ê–• ---
    function renderClientsSummary() {
      const tbody = document.getElementById('clientsBody');
      if (!tbody) return;

      const orders = loadOrders();
      const map = {};

      orders.forEach(order => {
        const name = (order.customer || '–ë–µ–∑ —ñ–º–µ–Ω—ñ').trim() || '–ë–µ–∑ —ñ–º–µ–Ω—ñ';
        if (!map[name]) {
          map[name] = {
            ordersCount: 0,
            trays: 0,
            eggs: 0,
            amount: 0,
            lastDate: ''
          };
        }
        const rec = map[name];
        rec.ordersCount += 1;
        const trays = order.trays || 0;
        const eggs = order.eggs || (trays * 20);
        rec.trays += trays;
        rec.eggs += eggs;
        rec.amount += (order.amount || 0);

        if (order.date) {
          if (!rec.lastDate) {
            rec.lastDate = order.date;
          } else {
            // –ø—Ä–æ—Å—Ç–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ YYYY-MM-DD
            if (order.date > rec.lastDate) {
              rec.lastDate = order.date;
            }
          }
        }
      });

      tbody.innerHTML = '';

      Object.keys(map).forEach(name => {
        const rec = map[name];
        const tr = document.createElement('tr');

        const tdName = document.createElement('td');
        tdName.textContent = name;
        tr.appendChild(tdName);

        const tdCnt = document.createElement('td');
        tdCnt.textContent = rec.ordersCount;
        tr.appendChild(tdCnt);

        const tdTrays = document.createElement('td');
        tdTrays.textContent = rec.trays;
        tr.appendChild(tdTrays);

        const tdEggs = document.createElement('td');
        tdEggs.textContent = rec.eggs;
        tr.appendChild(tdEggs);

        const tdAmount = document.createElement('td');
        tdAmount.textContent = rec.amount.toFixed(2);
        tr.appendChild(tdAmount);

        const tdLast = document.createElement('td');
        tdLast.textContent = rec.lastDate || '';
        tr.appendChild(tdLast);

        tbody.appendChild(tr);
      });
    }
    
        // --- –Ü–ù–ö–£–ë–ê–¶–Ü–Ø ---
    function loadIncubations() {
      const raw = localStorage.getItem('quailIncubations');
      if (!raw) return [];
      try {
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —ñ–Ω–∫—É–±–∞—Ü—ñ–π', e);
        return [];
      }
    }

    function saveIncubations(list) {
      localStorage.setItem('quailIncubations', JSON.stringify(list));
    }

    function addIncubation() {
      const nameEl = document.getElementById('incBatchName');
      const dateEl = document.getElementById('incStartDate');
      const eggsEl = document.getElementById('incEggsSet');
      const noteEl = document.getElementById('incNote');

      if (!nameEl || !dateEl || !eggsEl) return;

      const name = (nameEl.value || '').trim() || '–ë–µ–∑ –Ω–∞–∑–≤–∏';
      const startDate = dateEl.value || new Date().toISOString().slice(0, 10);
      const eggsSet = parseInt(eggsEl.value) || 0;
      const note = noteEl ? noteEl.value : '';

      const list = loadIncubations();
      list.push({
        id: Date.now(),
        name,
        startDate,
        eggsSet,
        infertile: 0,
        hatched: 0,
        diedIncubator: 0,
        diedBrooder: 0,
        note
      });

      saveIncubations(list);
      renderIncubations();

      // –æ—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É
      nameEl.value = '';
      eggsEl.value = '0';
      if (noteEl) noteEl.value = '';
    }

    function renderIncubations() {
      const tbody = document.getElementById('incubationBody');
      if (!tbody) return;

      const list = loadIncubations();
      tbody.innerHTML = '';
      const today = new Date();

      list.forEach((batch, index) => {
        const tr = document.createElement('tr');

        const tdName = document.createElement('td');
        tdName.textContent = batch.name || '';
        tr.appendChild(tdName);

        const tdDate = document.createElement('td');
        tdDate.textContent = batch.startDate || '';
        tr.appendChild(tdDate);

        const tdDays = document.createElement('td');
        let daysStr = '';
        if (batch.startDate) {
          const d = new Date(batch.startDate);
          if (!isNaN(d)) {
            const diffMs = today - d;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24)) + 1;
            daysStr = diffDays.toString();
          }
        }
        tdDays.textContent = daysStr;
        tr.appendChild(tdDays);

        const tdEggsSet = document.createElement('td');
        tdEggsSet.textContent = batch.eggsSet != null ? batch.eggsSet : '';
        tr.appendChild(tdEggsSet);

        // –ù–µ–∑–∞–ø–ª—ñ–¥–Ω–µ–Ω—ñ
        const tdInf = document.createElement('td');
        const infInput = document.createElement('input');
        infInput.type = 'number';
        infInput.step = '1';
        infInput.style.width = '70px';
        infInput.value = batch.infertile != null ? batch.infertile : 0;
        infInput.addEventListener('input', function () {
          const list2 = loadIncubations();
          if (list2[index]) {
            list2[index].infertile = parseInt(this.value) || 0;
            saveIncubations(list2);
            renderIncubations();
          }
        });
        tdInf.appendChild(infInput);
        tr.appendChild(tdInf);

        // –í–∏–ª—É–ø–∏–ª–æ—Å—è
        const tdHatch = document.createElement('td');
        const hatchInput = document.createElement('input');
        hatchInput.type = 'number';
        hatchInput.step = '1';
        hatchInput.style.width = '70px';
        hatchInput.value = batch.hatched != null ? batch.hatched : 0;
        hatchInput.addEventListener('input', function () {
          const list2 = loadIncubations();
          if (list2[index]) {
            list2[index].hatched = parseInt(this.value) || 0;
            saveIncubations(list2);
            renderIncubations();
          }
        });
        tdHatch.appendChild(hatchInput);
        tr.appendChild(tdHatch);

        // –ü–æ–º–µ—Ä–ª–∏ –≤ —ñ–Ω–∫—É–±–∞—Ç–æ—Ä—ñ
        const tdDeadInc = document.createElement('td');
        const deadIncInput = document.createElement('input');
        deadIncInput.type = 'number';
        deadIncInput.step = '1';
        deadIncInput.style.width = '70px';
        deadIncInput.value = batch.diedIncubator != null ? batch.diedIncubator : 0;
        deadIncInput.addEventListener('input', function () {
          const list2 = loadIncubations();
          if (list2[index]) {
            list2[index].diedIncubator = parseInt(this.value) || 0;
            saveIncubations(list2);
            renderIncubations();
          }
        });
        tdDeadInc.appendChild(deadIncInput);
        tr.appendChild(tdDeadInc);

        // –ü–æ–º–µ—Ä–ª–∏ –≤ –±—Ä—É–¥–µ—Ä—ñ
        const tdDeadBr = document.createElement('td');
        const deadBrInput = document.createElement('input');
        deadBrInput.type = 'number';
        deadBrInput.step = '1';
        deadBrInput.style.width = '70px';
        deadBrInput.value = batch.diedBrooder != null ? batch.diedBrooder : 0;
        deadBrInput.addEventListener('input', function () {
          const list2 = loadIncubations();
          if (list2[index]) {
            list2[index].diedBrooder = parseInt(this.value) || 0;
            saveIncubations(list2);
            renderIncubations();
          }
        });
        tdDeadBr.appendChild(deadBrInput);
        tr.appendChild(tdDeadBr);

        // –ñ–∏–≤—ñ –∑–∞—Ä–∞–∑ = –≤–∏–ª—É–ø–∏–ª–æ—Å—å - –ø–æ–º–µ—Ä–ª–∏ –≤ —ñ–Ω–∫—É–±–∞—Ç–æ—Ä—ñ - –≤ –±—Ä—É–¥–µ—Ä—ñ
        const tdAlive = document.createElement('td');
        const hatched = batch.hatched || 0;
        const dInc = batch.diedIncubator || 0;
        const dBr = batch.diedBrooder || 0;
        const alive = Math.max(hatched - dInc - dBr, 0);
        tdAlive.textContent = alive.toString();
        tr.appendChild(tdAlive);

        const tdNote = document.createElement('td');
        tdNote.textContent = batch.note || '';
        tr.appendChild(tdNote);

        const tdActions = document.createElement('td');
        const btnDel = document.createElement('button');
        btnDel.textContent = '√ó';
        btnDel.className = 'btn btn-danger btn-small';
        btnDel.onclick = function () {
          const list2 = loadIncubations();
          list2.splice(index, 1);
          saveIncubations(list2);
          renderIncubations();
        };
        tdActions.appendChild(btnDel);
        tr.appendChild(tdActions);

        tbody.appendChild(tr);
      });
    }

    
   function addOrder() {
  const customer = document.getElementById('orderCustomer').value.trim();
  const trays = parseInt(document.getElementById('orderTrays').value) || 0;
  const note = document.getElementById('orderNote').value.trim();
  if (!customer || trays <= 0) {
    alert('–í–∫–∞–∂–∏ —ñ–º\'—è –∫–ª—ñ—î–Ω—Ç–∞ —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ª–æ—Ç–∫—ñ–≤ > 0');
    return;
  }

  const date = new Date().toISOString().slice(0, 10);
  const eggs = trays * 20;

  // üîπ –ë–µ—Ä–µ–º–æ –ø–æ—Ç–æ—á–Ω—É —Ü—ñ–Ω—É –∑–∞ –ª–æ—Ç–æ–∫
  const trayPrice = parseFloat(document.getElementById('trayPrice').value) || 0;
  const amount = trays * trayPrice;

  const orders = loadOrders();
  const totalTraysToday = parseInt(document.getElementById('traysCount')?.textContent || '0') || 0;
  const reservedTrays = parseInt(document.getElementById('reservedTrays')?.textContent || '0') || 0;
  if (reservedTrays + trays > totalTraysToday) {
  if (!confirm('–¶–∏–º –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º —Ç–∏ –ø–µ—Ä–µ–≤–∏—â–∏—à –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –ª–æ—Ç–∫–∏. –î–æ–¥–∞—Ç–∏ –≤—Å–µ –æ–¥–Ω–æ?')) {
  return;
        }
      }

  orders.push({
    customer,
    eggs,
    trays,
    date,
    note,
    amount,      // ‚¨ÖÔ∏è –¥–æ–¥–∞–Ω–æ
    done: false
  });
  saveOrders(orders);
  renderOrders();
  saveState();
}


    function clearOrders() {
      if (!confirm('–¢–æ—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?')) return;
      localStorage.removeItem('quailOrders');
      renderOrders();
    }

       // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---
    function attachEvents() {
      // –¶—ñ–Ω–∏
      document.querySelectorAll('.price').forEach(input => {
        input.addEventListener('input', () => {
          recalcAll();
          saveState();
        });
      });

      // –ó–∞–ø–∞—Å–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
      document.querySelectorAll('.stock').forEach(input => {
        input.addEventListener('input', () => {
          recalcStocks();
          saveState();
        });
      });

      // –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–ª—è, —â–æ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏
      [
        'birds', 'dailyNorm',
        'hens1', 'hens2',
        'eggsTotal', 'eggsBad', 'eggsOwn', 'eggsCarry',
        'trayPrice',
        'logDate', 'logNote',
        'orderCustomer', 'orderTrays', 'orderNote'
      ].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('input', () => {
            recalcAll();
            saveState();
          });
        }
      });

      // –ö–Ω–æ–ø–∫–∏ —â–æ–¥–µ–Ω–Ω–∏–∫–∞
      const addToLogBtn = document.getElementById('addToLog');
      if (addToLogBtn) {
        addToLogBtn.addEventListener('click', () => {
          addToLog();
          saveState();
        });
      }

      const clearLogBtn = document.getElementById('clearLog');
      if (clearLogBtn) {
        clearLogBtn.addEventListener('click', () => {
          clearLog();
        });
      }

      // –ö–Ω–æ–ø–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω—å
      const addOrderBtn = document.getElementById('addOrder');
      if (addOrderBtn) {
        addOrderBtn.addEventListener('click', () => {
          addOrder();
        });
      }

      const clearOrdersBtn = document.getElementById('clearOrders');
      if (clearOrdersBtn) {
        clearOrdersBtn.addEventListener('click', () => {
          clearOrders();
        });
      }

      // –Ü–Ω–∫—É–±–∞—Ü—ñ—è
      const addIncBtn = document.getElementById('addIncubation');
      if (addIncBtn) {
        addIncBtn.addEventListener('click', () => {
          addIncubation();
        });
      }

      const periodSelect = document.getElementById('reportPeriod');
      if (periodSelect) {
      periodSelect.addEventListener('change', () => {
      recalcReport();
      saveState();
        });
      }

      // –ü—Ä–µ—Å–µ—Ç–∏ —Ä–µ—Ü–µ–ø—Ç—É
      const presetSelect = document.getElementById('recipePreset');
      const presetBtn = document.getElementById('applyPreset');
      if (presetSelect && presetBtn) {
        presetBtn.addEventListener('click', () => {
          applyRecipePreset(presetSelect.value);
        });
      }
      
      const otherInput = document.getElementById('otherCostsMonthly');
      if (otherInput) {
      otherInput.addEventListener('input', () => {
      recalcReport();
      saveState();
      });
      }

      const produceBtn = document.getElementById('produceFeedBatch');
      if (produceBtn) {
        produceBtn.addEventListener('click', produceFeedBatch);
      }

      const consumeBtn = document.getElementById('consumeDailyFeed');
      if (consumeBtn) {
        consumeBtn.addEventListener('click', consumeDailyFeed);
      }

      
      // –ö–Ω–æ–ø–∫–∏ –±–µ–∫–∞–ø—É
      const backupExportBtn = document.getElementById('backupExport');
      if (backupExportBtn) {
        backupExportBtn.addEventListener('click', backupExport);
      }

      
      const backupImportBtn = document.getElementById('backupImport');
      if (backupImportBtn) {
        backupImportBtn.addEventListener('click', backupImport);
      }
    }
    
       // –ó–∞–ø—É—Å–∫
    loadState();
    attachEvents();
    recalcAll();
    renderLog();
    renderOrders();
    renderFeedReadyStock();
    renderIncubations();
    renderClientsSummary();
    updateDashboard();
    updateWarnings();
    
    
    // ----- GOOGLE DRIVE AUTH ----- //

let tokenClient;
let gapiInited = false;
let gisInited = false;

// –¢–≤–æ—ó scopes
scope: 'https://www.googleapis.com/auth/drive.file'

// INIT GAPI
function gapiLoaded() {
  gapi.load("client", initializeGapiClient);
}

async function initializeGapiClient() {
  await gapi.client.init({
    apiKey: "",
    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
  });
  gapiInited = true;
  maybeEnableButtons();
}

// INIT GOOGLE IDENTITY
function gisLoaded() {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: "764633127034-9t077tdhl7t1bcrsvml5nlil9vitdool.apps.googleusercontent.com",
    scope: SCOPES,
    callback: (resp) => {
      if (resp.access_token) {
        console.log("Logged in to Google");
      }
      maybeEnableButtons();
    },
  });
  gisInited = true;
  maybeEnableButtons();
}

function maybeEnableButtons() {
  const btnLogin = document.getElementById("btnDriveLogin");
  const btnBackup = document.getElementById("btnDriveBackup");
  const btnRestore = document.getElementById("btnDriveRestore");

  if (gapiInited && gisInited) {
    btnLogin.disabled = false;
  }
}

// --- LOGIN BUTTON ---
document.getElementById("btnDriveLogin").onclick = () => {
  tokenClient.requestAccessToken({ prompt: "consent" });
};

// --- SAVE BACKUP TO DRIVE ---
document.getElementById("btnDriveBackup").onclick = async () => {
  const backup = localStorage.getItem("quailState") || "{}";

  const fileContent = backup;
  const file = new Blob([fileContent], { type: "application/json" });

  const metadata = {
    name: "quail_calculator_backup.json",
    mimeType: "application/json",
  };

  const form = new FormData();
  form.append(
    "metadata",
    new Blob([JSON.stringify(metadata)], { type: "application/json" })
  );
  form.append("file", file);

  const res = await fetch(
    "https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",
    {
      method: "POST",
      headers: new Headers({
        Authorization: `Bearer ${gapi.client.getToken().access_token}`,
      }),
      body: form,
    }
  );

  alert("–ë–µ–∫–∞–ø –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –≤ Google Drive");
};

// --- RESTORE BACKUP FROM DRIVE ---
document.getElementById("btnDriveRestore").onclick = async () => {
  const res = await gapi.client.drive.files.list({
    q: "name='quail_calculator_backup.json'",
    spaces: "drive",
    fields: "files(id, name)",
  });

  if (res.result.files.length === 0) {
    alert("–ë–µ–∫–∞–ø –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É Google Drive");
    return;
  }

  const fileId = res.result.files[0].id;

  const file = await gapi.client.drive.files.get({
    fileId,
    alt: "media",
  });

  localStorage.setItem("quailState", file.body);
  alert("–ë–µ–∫–∞–ø –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ!");
  location.reload();
};


/* ---------------- GOOGLE DRIVE BACKUP ---------------- */

let tokenClient;
let gapiInited = false;
let gisInited = false;
let accessToken = null;

function gapiLoaded() {
  gapi.load("client", initializeGapiClient);
}

async function initializeGapiClient() {
  await gapi.client.init({
    apiKey: "AIzaSyA1-EXAMPLE-KEY",   // ‚Üê –ú–æ–∂–µ—à –Ω–µ —Å—Ç–∞–≤–∏—Ç–∏, Google Drive –ø—Ä–∞—Ü—é—î –±–µ–∑ –Ω—å–æ–≥–æ
    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
  });
  gapiInited = true;
}

function gisLoaded() {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: "764633127034-9t077tdhl7t1bcrsvml5nlil9vitdool.apps.googleusercontent.com",
    scope: "https://www.googleapis.com/auth/drive.file",
    callback: (tokenResponse) => {
      accessToken = tokenResponse.access_token;
      document.getElementById("btnDriveBackup").disabled = false;
      document.getElementById("btnDriveRestore").disabled = false;
      document.getElementById("btnDriveLogin").textContent = "‚úî –£–≤—ñ–π—à–æ–≤ —É Google";
    }
  });
}

  </script>
  
<script>
const CLIENT_ID = "764633127034-9t077tdhl7t1bcrsvml5nlil9vitdool.apps.googleusercontent.com";
const API_KEY = "";
const SCOPES = 'https://www.googleapis.com/auth/drive.file';
let tokenClient;
let accessToken = null;
let gapiInited = false;
let gisInited = false;

function gapiLoaded() {
  gapi.load('client', initializeGapiClient);
}

async function initializeGapiClient() {
  await gapi.client.init({
    apiKey: API_KEY,
    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
  });
  gapiInited = true;
}

function gisLoaded() {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    callback: (tokenResponse) => {
      accessToken = tokenResponse.access_token;
      document.getElementById("btnDriveBackup").disabled = false;
      document.getElementById("btnDriveRestore").disabled = false;
      getUserInfo();
    },
  });
  gisInited = true;
}

function handleAuthClick() {
  if (!gapiInited || !gisInited) {
    alert("Google API —â–µ –Ω–µ –≥–æ—Ç–æ–≤–µ. –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥.");
    return;
  }
  tokenClient.requestAccessToken({ prompt: 'consent' });
}

async function getUserInfo() {
  const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
    headers: { 'Authorization': 'Bearer ' + accessToken },
  });
  const profile = await response.json();
  document.getElementById("btnDriveLogin").innerText = "‚úÖ –£–≤—ñ–π—à–æ–≤: " + (profile.email || "Google –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á");
}

async function googleBackup() {
  if (!accessToken) {
    alert("–°–ø–µ—Ä—à—É —É–≤—ñ–π–¥–∏ –≤ Google!");
    return;
  }
  const content = JSON.stringify(localStorage);
  const blob = new Blob([content], { type: 'application/json' });
  const metadata = {
    name: 'quail_calculator_backup.json',
    mimeType: 'application/json'
  };

  const form = new FormData();
  form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
  form.append('file', blob);

  const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
    method: 'POST',
    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
    body: form
  });

  if (response.ok) {
    alert("‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –≤ Google Drive");
  } else {
    const err = await response.json();
    alert("‚ùå –ü–æ–º–∏–ª–∫–∞: " + (err.error?.message || JSON.stringify(err)));
  }
}

async function googleRestore() {
  alert("üîú –§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —â–µ –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ");
}

document.getElementById("btnDriveLogin").onclick = handleAuthClick;
</script>
  

<script src="https://accounts.google.com/gsi/client" async defer onload="gisLoaded()"></script>
<script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>

  
</body>
</html>

















