<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quail Calculator — Material 3</title>
    <link rel="stylesheet" href="material.css">
</head>

<body>

<!-- APP BAR (Material 3 Top App Bar) -->
<header class="m3-appbar">
    <h1 class="m3-title">Quail Calculator</h1>
</header>

<!-- MAIN CONTENT WRAPPER -->
<main class="m3-container">

    <!-- SECTION 1 — FEED CALCULATOR -->
<div class="m3-card">

    <h2>1. Комбікорм</h2>

    <div class="m3-input">
        <label>Бажана вага партії (кг)</label>
        <input type="number" id="targetKg" value="25" onchange="recalcFeed()">
    </div>

    <div style="margin-bottom: 12px;">
        <button class="m3-btn" onclick="applyRecipePreset('starter')">Стартер</button>
        <button class="m3-btn" onclick="applyRecipePreset('grower')">Гровер</button>
        <button class="m3-btn" onclick="applyRecipePreset('layer')">Несучки</button>
    </div>

    <table class="m3-table" id="feedTable">
        <thead>
            <tr>
                <th>Компонент</th>
                <th>К-сть (кг)</th>
                <th>Ціна</th>
                <th>Сума</th>
            </tr>
        </thead>
        <tbody id="feedRows">
            <!-- Генерується автоматично -->
        </tbody>
    </table>

    <p><b>Загальна вага:</b> <span id="feedTotalKg">0</span> кг</p>
    <p><b>Загальна вартість:</b> <span id="feedTotalCost">0</span> грн</p>

</div>

<!-- SECTION 2 — EGGS -->
<div class="m3-card">

<!-- 2. Облік яєць -->
<div class="m3-card" id="sec-eggs">

  <h2 class="m3-title">2. Облік яєць</h2>

  <p>Кількість зібраних яєць за добу:
    <input type="number" id="eggsTotal" value="0" step="1" style="width:80px;" oninput="recalcEggsBalance(); recalcProductivity();">
  </p>

  <p>Браковані яйця:
    <input type="number" id="eggsBad" value="0" step="1" style="width:80px;" oninput="recalcEggsBalance(); recalcProductivity();">
  </p>

  <p>Для власного використання:
    <input type="number" id="eggsOwn" value="0" step="1" style="width:80px;" oninput="recalcEggsBalance(); recalcProductivity();">
  </p>

  <p>Яйця, що залишилися з попередніх днів (складський залишок):
    <input type="number" id="eggsCarry" value="0" step="1" style="width:80px;" oninput="recalcEggsBalance();">
    <span class="small">Якщо щось збилося — виправ вручну.</span>
  </p>

  <div class="table-wrapper">
    <table class="m3-table">
      <tr>
        <td>Яєць доступно для продажу СЬОГОДНІ</td>
        <td class="right"><span id="eggsForSale">0</span></td>
      </tr>
      <tr>
        <td>Всього яєць для продажу (разом із залишком)</td>
        <td class="right"><span id="eggsForSaleTotal">0</span></td>
      </tr>
      <tr>
        <td>Кількість повних лотків (по 20 шт)</td>
        <td class="right"><span id="traysCount">0</span></td>
      </tr>
      <tr>
        <td>Залишок яєць після повних лотків</td>
        <td class="right"><span id="eggsRemainder">0</span></td>
      </tr>
      <tr>
        <td>Ціна за 1 лоток, грн</td>
        <td><input type="number" id="trayPrice" value="0" step="1" style="width:80px;" oninput="recalcEggsBalance();"></td>
      </tr>
      <tr>
        <td>Сума виручки, грн</td>
        <td class="right"><span id="income">0.00</span></td>
      </tr>
    </table>
  </div>

  <h3>2.2. Самки та продуктивність</h3>

  <p>Кількість самок у 1-й партії (7 серпня):
    <input type="number" id="hens1" value="0" step="1" style="width:80px;" oninput="recalcProductivity();">
  </p>

  <p>Кількість самок у 2-й партії (19 жовтня):
    <input type="number" id="hens2" value="0" step="1" style="width:80px;" oninput="recalcProductivity();">
  </p>

  <div class="table-wrapper">
    <table class="m3-table">
      <tr>
        <td>Самок всього</td>
        <td class="right"><span id="hensTotal">0</span></td>
      </tr>
      <tr>
        <td>Фактична продуктивність сьогодні, %</td>
        <td class="right"><span id="productivityToday">0.0</span></td>
      </tr>
    </table>
  </div>

</div>

<!-- SECTION 3 — STOCKS -->
<div class="m3-card">

    <h2>3. Запаси компонентів</h2>

    <table class="m3-table">
        <thead>
            <tr>
                <th>Компонент</th>
                <th>Є (кг)</th>
                <th>Потрібно</th>
                <th>Докупити</th>
            </tr>
        </thead>
        <tbody id="stockRows">
            <!-- Генерується автоматично -->
        </tbody>
    </table>

</div>

<!-- SECTION 4 — LOG -->
<div class="m3-card">

    <h2>4. Щоденник витрат</h2>

    <div class="m3-input">
        <label>Дата</label>
        <input type="date" id="logDate">
    </div>

    <div class="m3-input">
        <label>Категорія</label>
        <input type="text" id="logCategory">
    </div>

    <div class="m3-input">
        <label>Сума (грн)</label>
        <input type="number" id="logAmount">
    </div>

    <div class="m3-input">
        <label>Коментар</label>
        <input type="text" id="logComment">
    </div>

    <button class="m3-btn" onclick="addLog()">Додати запис</button>

    <table class="m3-table">
        <thead>
            <tr>
                <th>Дата</th>
                <th>Категорія</th>
                <th>Сума</th>
                <th>Коментар</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="logBody"></tbody>
    </table>

</div>

<!-- SECTION 5 — ORDERS -->
<div class="m3-card">

    <h2>5. Замовлення</h2>

    <div class="m3-input">
        <label>Клієнт</label>
        <input type="text" id="ordName">
    </div>

    <div class="m3-input">
        <label>Яєць</label>
        <input type="number" id="ordEggs">
    </div>

    <div class="m3-input">
        <label>Лотків</label>
        <input type="number" id="ordTrays">
    </div>

    <div class="m3-input">
        <label>Дата</label>
        <input type="date" id="ordDate">
    </div>

    <div class="m3-input">
        <label>Примітка</label>
        <input type="text" id="ordNote">
    </div>

    <button class="m3-btn" onclick="addOrder()">Додати</button>

    <h3>Активні замовлення</h3>
    <table class="m3-table">
        <tbody id="ordersActive"></tbody>
    </table>

    <h3>Виконані</h3>
    <table class="m3-table">
        <tbody id="ordersDone"></tbody>
    </table>

</div>

<!-- SECTION 6 — INCUBATION -->
<div class="m3-card">

    <h2>6. Інкубація</h2>

    <div class="m3-input">
        <label>Дата закладки</label>
        <input type="date" id="incDate">
    </div>

    <div class="m3-input">
        <label>Кількість яєць</label>
        <input type="number" id="incEggs">
    </div>

    <div class="m3-input">
        <label>Примітка</label>
        <input type="text" id="incNote">
    </div>

    <button class="m3-btn" onclick="addInc()">Додати партію</button>

    <table class="m3-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Дата</th>
                <th>Яєць</th>
                <th>Вилуп</th>
                <th>Примітка</th>
                <th>День</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="incBody"></tbody>
    </table>

</div>

<!-- SECTION 7 — GRAPHS -->
<div class="m3-card">

    <h2>7. Графіки продуктивності</h2>

    <div class="m3-chart">
        <canvas id="chartEggs"></canvas>
    </div>

    <div class="m3-chart">
        <canvas id="chartIncome"></canvas>
    </div>

</div>

<!-- SECTION 8 — FLOCK -->
<div class="m3-card">

    <h2>8. Поголів’я</h2>

    <div class="m3-input">
        <label>Кількість самців</label>
        <input type="number" id="males" value="10" onchange="recalcFlock()">
    </div>

    <div class="m3-input">
        <label>Кількість самок</label>
        <input type="number" id="females" value="40" onchange="recalcFlock()">
    </div>

    <div class="m3-input">
        <label>Смертність</label>
        <input type="number" id="deaths" value="0" onchange="recalcFlock()">
    </div>

    <div class="m3-input">
        <label>Середній вік (днів)</label>
        <input type="number" id="avgAge" value="60" onchange="recalcFlock()">
    </div>

    <p><b>Усього поголів'я:</b> <span id="flockTotal">50</span></p>

</div>

<!-- SECTION 9 — FEED STOCK -->
<div class="m3-card">

    <h2>9. Загальні запаси комбікорму</h2>

    <table class="m3-table">
        <thead>
            <tr>
                <th>Компонент</th>
                <th>Є (кг)</th>
                <th>Потрібно</th>
                <th>Докупити</th>
            </tr>
        </thead>
        <tbody id="stockRows2">
            <!-- якщо потрібно — можна підключити окрему логіку -->
        </tbody>
    </table>

</div>

<!-- 10. ФІНАНСОВА АНАЛІТИКА -->
<div class="m3-card" id="sec-finance">

  <!-- 10.1. Підсумок дня -->
  <h2 class="m3-title">10.1. Підсумок дня (корм + яйця)</h2>
  <div class="table-wrapper">
    <table class="m3-table">
      <tr>
        <td>Добова вартість корму (все стадо), грн</td>
        <td class="right"><span id="summaryFeedCost">0.00</span></td>
      </tr>
      <tr>
        <td>Добова виручка від яєць, грн</td>
        <td class="right"><span id="summaryEggIncome">0.00</span></td>
      </tr>
      <tr>
        <td>Орієнтовний результат за день (прибуток/збиток), грн</td>
        <td class="right"><span id="summaryProfit">0.00</span></td>
      </tr>
    </table>
  </div>

  <!-- 10.2. Фінансовий звіт за період -->
  <h2 class="m3-title" id="financeSection">10.2. Фінансовий звіт за період</h2>

  <p>
    Період:
    <select id="reportPeriod" onchange="recalcReport()">
      <option value="7">Останні 7 днів</option>
      <option value="30" selected>Останні 30 днів</option>
      <option value="all">За весь час</option>
    </select>
  </p>

  <p>
    Інші постійні витрати (на місяць), грн:
    <input type="number" id="otherCostsMonthly" value="0" step="1" style="width:100px;"
           oninput="recalcReport()">
    <span class="small">Електрика, підстилка, амортизація тощо</span>
  </p>
  
  <div class="table-wrapper">
    <table class="m3-table">
      <tr>
        <td>Днів у звіті</td>
        <td class="right"><span id="repDays">0</span></td>
      </tr>
      <tr>
        <td>Зібрано яєць, шт</td>
        <td class="right"><span id="repEggs">0</span></td>
      </tr>
      <tr>
        <td>Продано лотків (по 20 шт)</td>
        <td class="right"><span id="repTrays">0</span></td>
      </tr>
      <tr>
        <td>Виручка, грн</td>
        <td class="right"><span id="repIncome">0.00</span></td>
      </tr>
      <tr>
        <td>Витрати на корм, грн</td>
        <td class="right"><span id="repFeedCost">0.00</span></td>
      </tr>
      <tr>
        <td>Чистий результат (прибуток), грн</td>
        <td class="right"><span id="repProfit">0.00</span></td>
      </tr>
      <tr>
        <td>Середня продуктивність, %</td>
        <td class="right"><span id="repProdAvg">0.0</span></td>
      </tr>
      <tr>
        <td>Собівартість 1 яйця (корм), грн</td>
        <td class="right"><span id="repCostPerEgg">0.000</span></td>
      </tr>
      <tr>
        <td>Прибуток з 1 яйця, грн</td>
        <td class="right"><span id="repProfitPerEgg">0.000</span></td>
      </tr>
      <tr>
        <td>Прибуток з 1 самки за період, грн</td>
        <td class="right"><span id="repProfitPerHen">0.00</span></td>
      </tr>
      <tr>
        <td>Інші витрати за період, грн</td>
        <td class="right"><span id="repOtherCost">0.00</span></td>
      </tr>
      <tr>
        <td>Повна собівартість 1 яйця (корм + інші), грн</td>
        <td class="right"><span id="repFullCostPerEgg">0.000</span></td>
      </tr>
      <tr>
        <td>Прибуток з 1 яйця з урахуванням всіх витрат, грн</td>
        <td class="right"><span id="repProfitPerEggFull">0.000</span></td>
      </tr>
    </table>
  </div>

  <!-- 10.3. Прогноз на 30 днів -->
  <h2 class="m3-title">10.3. Прогноз на 30 днів</h2>
  <p class="small">
    Розрахунок на основі поточної середньої несучості, кількості самок, ціни лотка та добової вартості корму.
  </p>

  <div class="table-wrapper">
    <table class="m3-table">
      <tr>
        <td>Очікуваних яєць за 30 днів</td>
        <td class="right"><span id="fcastEggs">0</span></td>
      </tr>
      <tr>
        <td>Очікуваних лотків (по 20 шт)</td>
        <td class="right"><span id="fcastTrays">0</span></td>
      </tr>
      <tr>
        <td>Очікувана виручка, грн</td>
        <td class="right"><span id="fcastIncome">0.00</span></td>
      </tr>
      <tr>
        <td>Очікувані витрати на корм, грн</td>
        <td class="right"><span id="fcastFeedCost">0.00</span></td>
      </tr>
      <tr>
        <td>Орієнтовний прибуток за 30 днів, грн</td>
        <td class="right"><span id="fcastProfit">0.00</span></td>
      </tr>
    </table>
  </div>

</div>

<!-- SECTION 11 — PWA -->
<div class="m3-card">

    <h2>11. Оффлайн режим (PWA)</h2>

    <p>Щоб додати застосунок на головний екран:</p>

    <ul>
        <li><b>Android:</b> Меню → «Install App» або «Add to Home Screen».</li>
        <li><b>iOS:</b> кнопка Share → «Add to Home Screen».</li>
    </ul>

</div>

<!-- SECTION 12 — GOOGLE DRIVE BACKUP -->
<div class="m3-card">

    <h2>12. Резервне копіювання Google Drive</h2>

    <button class="m3-btn" id="btnDriveLogin">Увійти в Google</button>
    <button class="m3-btn m3-btn-secondary" id="btnBackup" disabled>Створити копію</button>
    <button class="m3-btn" id="btnRestore" disabled>Відновити</button>

    <p id="driveStatus">Статус: не авторизовано</p>

</div>

</main>

<!-- Google API LOADERS -->
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

<!-- ChartJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<!-- MAIN APP LOGIC -->
<script src="app.js"></script>

</body>
</html>