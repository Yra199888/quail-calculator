/* ============================================================
   core/data.js
   Єдиний глобальний об’єкт DATA для всієї системи
   Використовується всіма модулями (feed, eggs, orders, etc.)
============================================================ */

console.log("core/data.js loaded");

/* ------------------------------------------------------------
   1) Глобальний об’єкт DATA
------------------------------------------------------------ */
export const DATA = {

    /* -----------------------------------------
       Блок комбікорму (feed.js)
    ----------------------------------------- */
    feed: {
        recipe: {},          // поточний рецепт (проценти)
        components: {},      // розраховані кг кожного компоненту
        batchKg: 25,         // вага партії
        dailyPerHen: 30,     // г/день на 1 птицю
        ready: 0,            // готового комбікорму
        stock: {},           // запаси компонентів
        need: {},            // скільки треба докупити
        totalPercent: 0      // загальний % рецепту
    },

    /* -----------------------------------------
       Блок яєць (eggs.js)
    ----------------------------------------- */
    eggs: {
        totalToday: 0,
        bad: 0,
        own: 0,
        carry: 0,

        todayForSale: 0,
        totalForSale: 0,
        trays: 0,
        remainder: 0,

        trayPrice: 0,
        income: 0,

        hens1: 0,
        hens2: 0,
        hensTotal: 0,
        productivity: 0,

        reservedTrays: 0,
        freeTrays: 0
    },

    /* -----------------------------------------
       Замовлення (orders.js)
    ----------------------------------------- */
    orders: [],

    /* -----------------------------------------
       Клієнти (clients.js)
    ----------------------------------------- */
    clients: {},

    /* -----------------------------------------
       Фінанси (finance.js)
    ----------------------------------------- */
    finance: {
        dailyFeedCost: 0,
        dailyIncome: 0,
        dailyProfit: 0,

        repDays: 0,
        repEggs: 0,
        repTrays: 0,
        repIncome: 0,
        repFeedCost: 0,
        repProfit: 0,
        repProdAvg: 0,
        repCostPerEgg: 0,
        repProfitPerEgg: 0,
        repProfitPerHen: 0,
        repOtherCost: 0,
        repFullCostPerEgg: 0,
        repProfitPerEggFull: 0
    },

    /* -----------------------------------------
       Інкубація (incub.js)
    ----------------------------------------- */
    incub: [
        // кожна партія виглядає так:
        /*
        {
            id: 1,
            name: "",
            start: "2025-01-01",
            eggs: 0,
            infertile: 0,
            hatched: 0,
            diedInc: 0,
            diedBrooder: 0,
            note: "",
            days: 0
        }
        */
    ],

    /* -----------------------------------------
       Поголів’я (flock.js)
    ----------------------------------------- */
    flock: {
        males: 0,
        females: 0,
        deaths: 0,
        avgAge: 0
    },

    /* -----------------------------------------
       Логи витрат (logs.js)
    ----------------------------------------- */
    logs: [
        // { id: 1, date:"2025-01-01", category:"Корм", amount:50, comment:"..." }
    ],

    /* -----------------------------------------
       Службові дані для PWA/Drive Sync
    ----------------------------------------- */
    meta: {
        lastSync: null,
        lastLocalSave: null,
        offlineQueue: []
    }
};

/* ------------------------------------------------------------
   2) Функція оновлення дати
------------------------------------------------------------ */
export function updateMeta() {
    DATA.meta.lastLocalSave = new Date().toISOString();
}